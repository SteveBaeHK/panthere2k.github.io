<!doctype html><html lang=en theme=light is-docs-page js-focus-visible-polyfill-available><head><meta charset=utf-8><title>Create a serverless, globally distributed REST API with Fauna · Cloudflare Workers docs</title><meta http-equiv=cleartype content="on"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=application-name content="Create a serverless, globally distributed REST API with Fauna · Cloudflare Workers docs"><meta name=msapplication-tap-highlight content="no"><meta name=apple-mobile-web-app-title content="Create a serverless, globally distributed REST API with Fauna · Cloudflare Workers docs"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-capable content="yes"><meta name=mobile-web-app-capable content="yes"><meta name=theme-color content="#f38020"><meta name=description content="Documentation for Cloudflare Workers, a serverless execution environment that allows you to create entirely new applications or augment existing ones without configuring or maintaining infrastructure."><meta property="og:image" content="https://panthere2k.github.io/dev-products-preview.png"><meta property="og:title" content="Create a serverless, globally distributed REST API with Fauna · Cloudflare Workers docs"><meta property="og:description" content="Documentation for Cloudflare Workers, a serverless execution environment that allows you to create entirely new applications or augment existing ones without configuring or maintaining infrastructure."><meta property="og:type" content="website"><meta name=twitter:title content="Create a serverless, globally distributed REST API with Fauna · Cloudflare Workers docs"><meta name=twitter:image content="https://panthere2k.github.io/dev-products-preview.png"><meta name=twitter:description content="Documentation for Cloudflare Workers, a serverless execution environment that allows you to create entirely new applications or augment existing ones without configuring or maintaining infrastructure."><meta name=twitter:creator content="@cloudflare"><meta name=twitter:card content="summary_large_image"><meta name=pcx_content_type content="tutorial"><link rel=icon href=/favicon-32x32.png><link rel=canonical href=https://panthere2k.github.io/workers/tutorials/store-data-with-fauna/><link rel=sitemap href=/sitemap.xml type=application/xml><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon sizes=48x48 href=/icons/icon-48x48.png><link rel=apple-touch-icon sizes=72x72 href=/icons/icon-72x72.png><link rel=apple-touch-icon sizes=96x96 href=/icons/icon-96x96.png><link rel=apple-touch-icon sizes=144x144 href=/icons/icon-144x144.png><link rel=apple-touch-icon sizes=192x192 href=/icons/icon-192x192.png><link rel=apple-touch-icon sizes=256x256 href=/icons/icon-256x256.png><link rel=apple-touch-icon sizes=384x384 href=/icons/icon-384x384.png><link rel=apple-touch-icon sizes=512x512 href=/icons/icon-512x512.png><script src=/search.redirect.min.6828ce878577fe91120d67814d68c0d8.js defer></script><link rel="stylesheet preconnect" href=/style.css><script>(function(){let s=!1,e,n;document.readyState!=="loading"?o():addEventListener("DOMContentLoaded",o),e=document.querySelector("#ThemeToggle"),s=!e;function t(n){try{let o=n?"dark":"light";document.documentElement.setAttribute("theme",o),localStorage.theme=JSON.stringify({theme:o}),e?(e.checked=n,s=!1):s&&setTimeout(t,1,n)}catch{}}function o(){e=e||document.querySelector("#ThemeToggle"),e.addEventListener("change",()=>t(!!e.checked)),addEventListener("keydown",n=>{n.target===document.body&&n.which===68&&n.shiftKey&&(n.preventDefault(),t(!e.checked))})}try{n=window.matchMedia("(prefers-color-scheme:dark)"),n.onchange=e=>t(e.matches)}catch{}try{let e=localStorage.theme,s=e&&JSON.parse(e);t(s?/dark/.test(s.theme):!!(n&&n.matches))}catch{}})()</script><script src=/main.min.c2a5e976c412695a3d9389cba84aa5bd.js defer></script>
<script data-source=docs defer src=https://feedback.developers.cloudflare.com/sdk.js></script>
<link rel=preload href=https://feedback.developers.cloudflare.com/sdk.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://feedback.developers.cloudflare.com/sdk.css></noscript></head><body><div class=DocsPage><div><a class=skip-link href=#main>Skip to content</a></div><div class=DocsMobileHeader><a class="DocsMobileHeader--cloudflare-logo-link Link Link-without-underline" href=/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsMobileTitleHeader><a aria-current=page class="DocsMobileTitleHeader--logo-link Link Link-without-underline" href=/workers/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><span title="Cloudflare Workers logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 49"><path d="m18.63 37.418-9.645-12.9 9.592-12.533-1.852-2.527L5.917 23.595l-.015 1.808 10.86 14.542 1.868-2.527z"/><path d="M21.997 6.503h-3.712l13.387 18.3-13.072 17.7h3.735L35.4 24.81 21.997 6.503z"/><path d="M29.175 6.503h-3.758l13.598 18.082-13.598 17.918h3.765l12.908-17.01v-1.808L29.175 6.503z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:7>Workers</span></span></div></a><button class="Button DocsMobileTitleHeader--sidebar-toggle-button">
<span class=DocsMobileTitleHeader--sidebar-toggle-button-icon aria-hidden=true><svg viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="title-1332672649688018" xmlns="http://www.w3.org/2000/svg"><title id="title-1332672649688018">Navigation menu icon</title><path data-index="1" d="M5 7h10" transform-origin="10 7"/><path data-index="2" d="M5 10h10" transform-origin="10 10"/><path data-index="3" d="M5 13h10" transform-origin="10 13"/></svg><span is-visually-hidden>Open external link</span></span></button></div><div class=DocsMobileNavBackdrop></div><div class=DocsSidebar><div class=DocsSidebar--sections><div class="DocsSidebar--section DocsSidebar--header-section"><a class="DocsSidebar--cloudflare-logo-link DocsSidebar--link" href=/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsSidebar--section-separator></div><div class="DocsSidebar--section DocsSidebar--docs-title-section"><a aria-current=page class="DocsSidebar--docs-title-logo-link DocsSidebar--link" href=/workers/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><span title="Cloudflare Workers logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 49"><path d="m18.63 37.418-9.645-12.9 9.592-12.533-1.852-2.527L5.917 23.595l-.015 1.808 10.86 14.542 1.868-2.527z"/><path d="M21.997 6.503h-3.712l13.387 18.3-13.072 17.7h3.735L35.4 24.81 21.997 6.503z"/><path d="M29.175 6.503h-3.758l13.598 18.082-13.598 17.918h3.765l12.908-17.01v-1.808L29.175 6.503z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:7>Workers</span></span></div></a><div class="DocsSidebar--section-more Dropdown" data-expanded=false><button class="DocsSidebar--section-more-button Button" aria-expanded=false><div class=DocsSidebar--section-more-button-icon><svg viewBox="0 0 4 16" stroke="currentcolor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" fill="currentcolor" role="img" aria-labelledby="title-6032186738345315" xmlns="http://www.w3.org/2000/svg"><title id="title-6032186738345315">Dropdown icon</title><path d="M2 2v0m0 6v0m0 6v0z"/></svg><span is-visually-hidden>Workers menu</span></div></button><div class="DocsSidebar--section-more-dropdown Dropdown--dropdown"><ul class=Dropdown--list><li class=Dropdown--item><a class=Dropdown--link href=https://workers.cloudflare.com tabindex=-1>Workers home</a></li><li class=Dropdown--item><a class=Dropdown--link href=https://cloudflareworkers.com tabindex=-1>Playground</a></li><li class=Dropdown--item><a class=Dropdown--link href=https://workers.cloudflare.com/#plans tabindex=-1>Pricing</a></li><li class=Dropdown--item><a class=Dropdown--link href=https://discord.gg/cloudflaredev tabindex=-1>Discord</a></li></ul></div></div></div><div class="DocsSidebar--section DocsSidebar--nav-section" style=position:relative;overflow:hidden;width:100%;height:100%><div style=position:absolute;inset:0;overflow-y:auto;margin-right:0;margin-bottom:0><div class=DocsSidebar--nav-section-shadow style=opacity:0></div><ul class=DocsSidebar--nav><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Overview</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Get started</span>
</button><a class=DocsSidebar--nav-link href=/workers/get-started/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Get started</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/get-started/guide/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Guide</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/get-started/quickstarts/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Quickstarts</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/examples/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Examples</span></a></li><li class=DocsSidebar--nav-item is-active-root is-expanded><a class=DocsSidebar--nav-link href=/workers/tutorials/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Tutorials</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Learning</span>
</button><a class=DocsSidebar--nav-link href=/workers/learning/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Learning</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/how-workers-works/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How Workers works</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/security-model/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Security model</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/debugging-workers/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Debugging Workers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/logging-workers/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Logging from Workers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/metrics-and-analytics/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Metrics and analytics</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/how-the-cache-works/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How the Cache works</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Integrations</span>
</button><a class=DocsSidebar--nav-link href=/workers/learning/integrations/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Integrations</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/integrations/apis/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>APIs</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/integrations/databases/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Databases</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/integrations/external-services/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>External Services</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/how-kv-works/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How KV works</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/how-routing-works/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How routing works</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/migrating-to-module-workers/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Migrating to module Workers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/service-worker/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Using Service Worker syntax</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/using-durable-objects/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Using Durable Objects</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/using-streams/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Using Streams</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/using-websockets/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Using WebSockets</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/using-services/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers Services</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/continuous-integration/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Continuous Integration</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/learning/playground/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Playground</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Platform</span>
</button><a class=DocsSidebar--nav-link href=/workers/platform/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Platform</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/storage-objects/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Storage options guide</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/pricing/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Pricing</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/betas/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Betas</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Bindings</span>
</button><a class=DocsSidebar--nav-link href=/workers/platform/bindings/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Bindings</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/bindings/about-service-bindings/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>About Service bindings</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/changelog/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Changelog</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/compatibility-dates/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Compatibility dates</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/deploy-button/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Deploy button</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/deployments/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Deployments</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/environment-variables/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Environment variables</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/environments/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Environments</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/known-issues/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Known issues</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/languages/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Languages</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/limits/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Limits</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/logpush/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Logpush</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/workers-with-page-rules/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Page Rules</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Triggers</span>
</button><a class=DocsSidebar--nav-link href=/workers/platform/triggers/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Triggers</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/triggers/cron-triggers/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Cron Triggers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/triggers/custom-domains/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Custom Domains</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/triggers/routes/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Routes</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/notifications/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Usage notifications</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Workers Sites</span>
</button><a class=DocsSidebar--nav-link href=/workers/platform/sites/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers Sites</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/sites/start-from-existing/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Start from existing</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/sites/start-from-scratch/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Start from scratch</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/sites/start-from-worker/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Start from worker</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/platform/sites/configuration/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers Sites configuration</span></a></li></ul></div></div></div></div></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Runtime APIs</span>
</button><a class=DocsSidebar--nav-link href=/workers/runtime-apis/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Runtime APIs</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/add-event-listener/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>addEventListener</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/cache/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Cache</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/durable-objects/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Durable Objects</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/encoding/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Encoding</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/fetch/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Fetch</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/fetch-event/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>FetchEvent</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/headers/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Headers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/html-rewriter/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>HTMLRewriter</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/kv/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>KV</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/r2/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>R2</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/request/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Request</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/response/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Response</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/scheduled-event/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>ScheduledEvent</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/service-bindings/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Service bindings</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Streams</span>
</button><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Streams</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/readablestream/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>ReadableStream</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/readablestreambyobreader/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>ReadableStream BYOBReader</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/readablestreamdefaultreader/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>ReadableStream DefaultReader</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/transformstream/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>TransformStream</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/writablestream/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>WritableStream</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/streams/writablestreamdefaultwriter/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>WritableStream DefaultWriter</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/web-crypto/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Web Crypto</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/web-standards/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Web standards</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/runtime-apis/websockets/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>WebSockets</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Wrangler</span>
</button><a class=DocsSidebar--nav-link href=/workers/wrangler/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Wrangler</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/install-and-update/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Install/Update Wrangler</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/commands/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Commands</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/configuration/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Configuration</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/custom-builds/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Custom builds</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/workers-kv/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers KV</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/bundling/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Bundling</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/system-environment-variables/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>System Environment Variables</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/environments/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Environments</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/ci-cd/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Running in CI/CD</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/compare-v1-v2/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Comparing Wrangler 1 & 2</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/api/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>API</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Migration</span>
</button><a class=DocsSidebar--nav-link href=/workers/wrangler/migration/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Migration</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/migration/migrating-from-wrangler-1/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Migrating from Wrangler 1</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/migration/deprecations/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Deprecations</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/migration/eject-webpack/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Ejecting webpack</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex=-1>
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Wrangler 1 (legacy)</span>
</button><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/ tabindex=-1>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Wrangler 1 (legacy)</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/install-update/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Install / Update</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/authentication/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Authentication</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/commands/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Commands</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/configuration/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Configuration</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/workers/wrangler/cli-wrangler/webpack/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Webpack</span></a></li></ul></div></div></div></div></li></ul></div></div></div></div></li></ul></div><div style=position:absolute;height:6px;display:none;right:2px;bottom:2px;left:2px;border-radius:3px><div style=position:relative;display:block;height:100%;cursor:pointer;border-radius:inherit;background-color:rgba(0,0,0,.2)></div></div><div style=position:absolute;width:6px;display:none class="Scrollbars--track Scrollbars--track-vertical"><div style=position:relative;display:block;width:100% class="Scrollbars--thumb Scrollbars--thumb-vertical"></div></div></div><div class=toggleSidebar><button id=toggleSidebarButton style=width:2em;height:2em title="Click to collapse and expand the sidebar navigation"><svg id="toggleSidebarSVG" aria-hidden="true" height="1" width="1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path id="toggleSidebarSVGPath" d="M15 2a1 1 0 00-1 1v10a1 1 0 002 0V3a1 1 0 00-1-1zm-10.407.993-4.3 4.3a1 1 0 000 1.414l4.3 4.3a1 1 0 001.415-1.416L3.417 9H10a1 1 0 100-2H3.417l2.591-2.591A1 1 0 104.593 2.993z"/></svg></button></div></div><div class=DocsSidebar--shadow></div></div><div class=DocsToolbar><div class=DocsToolbar--search><div class=DocsSearch><div class=DocsSearch--input-wrapper><input type=text id=DocsSearch--input class=DocsSearch--input spellcheck=false autocomplete=false placeholder="Search docs..."><div class=DocsSearch--input-icon><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-9701125841014673" xmlns="http://www.w3.org/2000/svg"><title id="title-9701125841014673">Search icon (depiction of a magnifying glass)</title><path d="M11.999 10.585l3.458 3.458a1 1 0 01-1.414 1.414L10.585 12a6.5 6.5.0 111.414-1.414zM6.75 11.5a4.75 4.75.0 100-9.5 4.75 4.75.0 000 9.5z"/></svg></div><button disabled class=slashPlaceholder title="Press '/' to focus on the search bar" aria-label="Forward slash keyboard shortcut" tabindex=-1 type=button><div style=margin-top:-1px>/</span></div></button></div></div></div><div class=DocsToolbar--tools><button data-feedback=true class="DocsToolbar--feedback Button Button-is-docs-secondary">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><path d="M14 2.5H2l-.5.5v11.165l.863.345 2.852-3.01H14l.5-.5V3l-.5-.5zm-.5 8H4.785L2.5 12.911V3.5h11v7z" fill="currentcolor"/><path d="M12.5 5.003h-9v1h9v-1zm0 2.497h-9v1h9v-1z" fill="currentcolor"/></svg>Give Feedback</button><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--tools-icon-item><div class=Tooltip---root><div class=DocsToolbar--tools-icon-item-content><a class="Link Link-without-underline" href=https://github.com/cloudflare/cloudflare-docs><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-6991762763429039" xmlns="http://www.w3.org/2000/svg"><title id="title-6991762763429039">GitHub icon</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" fill-rule="evenodd"/></svg></a></div><span class=Tooltip role=tooltip position=bottom-end>Visit Workers on GitHub</span></div></div><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--theme-toggle><div class=Tooltip---root><div class=ThemeToggle><input type=checkbox id=ThemeToggle class=ThemeToggle--input>
<label class=ThemeToggle--toggle for=ThemeToggle><div class=ThemeToggle--toggle-handle></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--sun"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-8812071124069258" xmlns="http://www.w3.org/2000/svg"><title id="title-8812071124069258">Light theme icon (depiction of a sun)</title><path d="M7.5 11.465a3.482 3.482.0 01-1.596-.662L4.11 12.596a.5.5.0 01-.707-.707l1.793-1.793A3.482 3.482.0 014.535 8.5H2a.5.5.0 010-1h2.535a3.482 3.482.0 01.662-1.596L3.404 4.11a.5.5.0 01.707-.707l1.793 1.793A3.482 3.482.0 017.5 4.535V2a.5.5.0 011 0v2.535a3.482 3.482.0 011.596.662l1.793-1.793a.5.5.0 01.707.707l-1.793 1.793c.343.458.577 1.003.662 1.596H14a.5.5.0 110 1h-2.535a3.482 3.482.0 01-.662 1.596l1.793 1.793a.5.5.0 01-.707.707l-1.793-1.793a3.482 3.482.0 01-1.596.662V14a.5.5.0 11-1 0v-2.535z"/></svg></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--moon"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-5971296394189265" xmlns="http://www.w3.org/2000/svg"><title id="title-5971296394189265">Dark theme icon (depiction of a moon)</title><path d="M7.067 3.087a5 5 0 005.466 7.026A5 5 0 117.067 3.087z"/></svg></div></label><span class=Tooltip role=tooltip position=bottom-end>Set theme to dark (⇧+D)</span></div></div></div></div></div><main class=DocsBody><div class=DocsBody--sidebar with-styled-webkit-scrollbars><div class=DocsBody--sidebar-content-scroll-fade></div><div class=DocsBody--sidebar-content><ul class=DocsTableOfContents hidden><li><a class=DocsTableOfContents-link href=#docs-content>↑ Top</a></li></ul></nav></div></div><div id=docs-content data-reach-skip-nav-content></div><div class=DocsContent id=main page-type=document><article class=DocsMarkdown><h1 id=create-a-serverless-globally-distributed-rest-api-with-fauna>Create a serverless, globally distributed REST API with Fauna</h1><h2 id=before-you-start><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#before-you-start>&#8203;​</a></span>
<span>Before you start</span></h2><p>All of the tutorials assume you have already completed the <a href=/workers/get-started/guide/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Get started guide</span></a>, which gets you set up with a Cloudflare Workers account, and the Workers CLI tool, <a href=https://github.com/cloudflare/wrangler class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Wrangler</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>.</p><h2 id=overview><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#overview>&#8203;​</a></span>
<span>Overview</span></h2><p>In this tutorial you learn how to store and retrieve data in your Cloudflare Workers applications by building a REST API that manages an inventory catalog using <a href="https://fauna.com/?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Fauna</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> as its data layer.</p><h3 id=learning-goals><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#learning-goals>&#8203;​</a></span>
<span>Learning goals</span></h3><ul><li>How to store and retrieve data from Fauna in your Workers.</li><li>How to use Wrangler to store secrets securely.</li><li>How to use <a href=https://github.com/lukeed/worktop class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Worktop</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> to add routing to your Workers.</li></ul><p>Building with Fauna, Workers, and Worktop enables you to create a globally distributed, strongly consistent, fully serverless REST API in a single repository. You can develop and reason about your application as if it were a monolith but gain the resilience and reduced latency of a distributed application running at the edge.</p><p><img src=./media/fauna-cf-workers-diagram.jpg alt="Fauna architecture connecting to Cloudflare&amp;rsquo;s network to create super fast applications"></p><p>Fauna is a document-based database with a flexible schema. This allows you to define the structure of your data – whatever it may be – and store documents that adhere to that structure. In this tutorial, you will build a product inventory, where each <code>product</code> document must contain the following properties:</p><ul><li><strong>title</strong> - A human-friendly string that represents the title or name of a product.</li><li><strong>serialNumber</strong> - A machine-friendly string that uniquely identifies the product.</li><li><strong>weightLbs</strong> - A floating point number that represents the weight in pounds of the product.</li><li><strong>quantity</strong> A non-negative integer that represents how many items of a particular product there are in the inventory.</li></ul><p>Documents are stored in the <strong>Products</strong> <a href="https://docs.fauna.com/fauna/current/learn/introduction/key_concepts#collections?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>collection</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>. Collections in document databases are groups of related documents.</p><p>For this tutorial, all API endpoints are public. However, Fauna also offers multiple avenues for securing endpoints and collections. Refer to <a href="https://fauna.com/blog/choosing-an-authentication-strategy-with-fauna?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Choosing an authentication strategy with Fauna</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> for more information on authenticating users to your applications with Fauna.</p><h2 id=setting-up-fauna><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#setting-up-fauna>&#8203;​</a></span>
<span>Setting up Fauna</span></h2><h3 id=creating-your-database><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#creating-your-database>&#8203;​</a></span>
<span>Creating your database</span></h3><p>Open the <a href="https://dashboard.fauna.com/?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Fauna dashboard</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> in your browser and log in to your Fauna account.</p><aside class=DocsMarkdown--aside role=note data-type=note><div class=DocsMarkdown--aside-header>Fauna Account</div>If you do not have a Fauna account, you can [sign up][fauna-signup] and deploy this template using the free tier.</aside><p>In the Fauna dashboard:</p><ol><li>Select <strong>Create database</strong>.</li><li>Provide a valid name.</li><li>Select the <strong>Classic</strong> <a href="https://docs.fauna.com/fauna/current/api/fql/region_groups#how-to-use-region-groups?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Region Group</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>.</li><li>Select <strong>Create</strong>.</li></ol><p><img src=./media/create-database.png alt="Create your database in Fauna by setting a name and region group"></p><h3 id=creating-the-products-catalog><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#creating-the-products-catalog>&#8203;​</a></span>
<span>Creating the products catalog</span></h3><p>Select <strong>New Collection</strong> to create the <strong>Products</strong> collection that stores your inventory documents.</p><p><img src=./media/create-collection.png alt="Create your Products collection by following the directions above"></p><h3 id=creating-a-server-key><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#creating-a-server-key>&#8203;​</a></span>
<span>Creating a server key</span></h3><p>You must create a key to connect to the database from your Worker.</p><p>Go to the <strong>Security</strong> tab in the Fauna dashboard and create a new key with the <strong>Server</strong> role:</p><p><img src=./media/new-server-key.png alt="Create a new key in the Security tab of the Fauna dashboard"></p><p>The Fauna dashboard displays the key&rsquo;s secret. Copy and save this server key to use in a later step.</p><aside class=DocsMarkdown--aside role=note data-type=warning><div class=DocsMarkdown--aside-header>Protect your keys</div>Server keys can read and write all documents in all collections and can call all [user-defined functions][fauna-udfs] (UDFs). Protect server keys and do not commit them to source control repositories.</aside><h2 id=managing-your-inventory-with-workers><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#managing-your-inventory-with-workers>&#8203;​</a></span>
<span>Managing your inventory with Workers</span></h2><p>Create a new project by cloning the <a href=https://github.com/fauna-labs/fauna-workers class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>fauna-workers</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> template repo on GitHub.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Create a Workers <span class=k>function</span>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ git clone https://github.com/fauna-labs/fauna-workers
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> fauna-workers
</span></span><span class=line><span class=cl>$ wrangler publish
</span></span></code></pre></div><aside class=DocsMarkdown--aside role=note data-type=note><div class=DocsMarkdown--aside-header>Publish before storing secrets</div>You must publish a version of your project before storing your server secret in the next step.</aside><h3 id=adding-your-fauna-secret-as-an-environment-variable><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#adding-your-fauna-secret-as-an-environment-variable>&#8203;​</a></span>
<span>Adding your Fauna secret as an environment variable</span></h3><p>After creating and deploying your Worker, store your Fauna client <a href=/workers/wrangler/cli-wrangler/commands/#put class=DocsMarkdown--link><span class=DocsMarkdown--link-content>secret</span></a> safely with the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Storing your Fauna secret
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ wrangler secret put FAUNA_SECRET
</span></span></code></pre></div><p>When prompted, paste the Fauna server secret you obtained earlier.</p><p>The <code>FAUNA_SECRET</code> environment variable is now injected automatically into your Worker code at runtime.</p><h3 id=installing-dependencies><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#installing-dependencies>&#8203;​</a></span>
<span>Installing dependencies</span></h3><p>First, install the Fauna JavaScript driver.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Installing the Fauna driver
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ npm install faunadb
</span></span></code></pre></div><p>Next, install the <a href=https://github.com/lukeed/worktop class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Worktop</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> framework for Cloudflare Workers.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Installing Worktop
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ npm install worktop@0.7
</span></span><span class=line><span class=cl>$ npm install worktop.build --save-dev
</span></span></code></pre></div><p>Worktop solves common needs such as routing, path parameters, and HTTP methods.</p><p>Edit <code>package.json</code> and add the <code>build</code> script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;build&#34;</span><span class=p>:</span> <span class=s2>&#34;worktop build index.js&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Edit your <code>wrangler.toml</code> file found in your Worker&rsquo;s project directory. Set the type to <code>"javascript"</code> (not <code>"webpack"</code>) and add the <code>[build]</code> and <code>[build.upload]</code> sections as shown in the following snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=err>:</span> <span class=nx>wrangler</span><span class=p>.</span><span class=nx>toml</span>
</span></span><span class=line><span class=cl><span class=nx>---</span>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=p>=</span> <span class=s2>&#34;javascript&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>command</span> <span class=p>=</span> <span class=s2>&#34;npm run build&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>.</span><span class=nx>upload</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>format</span> <span class=p>=</span> <span class=s2>&#34;service-worker&#34;</span>
</span></span></code></pre></div><h3 id=javascript-utility-functions><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#javascript-utility-functions>&#8203;​</a></span>
<span>JavaScript utility functions</span></h3><p>Create a <code>utils.js</code> file in the project folder and paste the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>utils</span><span class=p>.</span><span class=nx>js</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>description</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>error</span><span class=p>.</span><span class=nx>requestResult</span><span class=p>.</span><span class=nx>responseContent</span><span class=p>.</span><span class=nx>errors</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;unauthorized&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;authentication failed&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>401</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;permission denied&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>403</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;instance not found&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;instance not unique&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;contended transaction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>409</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>description</span><span class=p>,</span> <span class=nx>status</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>getFaunaError()</code> function extracts the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Status class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>HTTP response status codes</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> and description for the most common errors returned by Fauna.</p><h3 id=base-inventory-logic><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#base-inventory-logic>&#8203;​</a></span>
<span>Base inventory logic</span></h3><p>Replace the contents of your <code>index.js</code> file with the skeleton of your API:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>index</span><span class=p>.</span><span class=nx>js</span> <span class=p>(</span><span class=nx>skeleton</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>Router</span><span class=p>,</span> <span class=nx>listen</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;worktop&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>faunadb</span> <span class=nx>from</span> <span class=s1>&#39;faunadb&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>getFaunaError</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./utils.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>faunaClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>faunadb</span><span class=p>.</span><span class=nx>Client</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>secret</span><span class=o>:</span> <span class=nx>FAUNA_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span><span class=nx>Create</span><span class=p>,</span> <span class=nx>Collection</span><span class=p>,</span> <span class=nx>Match</span><span class=p>,</span> <span class=nx>Index</span><span class=p>,</span> <span class=nx>Get</span><span class=p>,</span> <span class=nx>Ref</span><span class=p>,</span> <span class=nx>Paginate</span><span class=p>,</span> <span class=nx>Sum</span><span class=p>,</span> <span class=nx>Delete</span><span class=p>,</span> <span class=nx>Add</span><span class=p>,</span> <span class=nx>Select</span><span class=p>,</span> <span class=nx>Let</span><span class=p>,</span> <span class=nx>Var</span><span class=p>,</span> <span class=nx>Update</span><span class=p>}</span> <span class=o>=</span> <span class=nx>faunadb</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=s1>&#39;hello world&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>listen</span><span class=p>(</span><span class=nx>router</span><span class=p>.</span><span class=nx>run</span><span class=p>);</span>
</span></span></code></pre></div><p>Examine the initialization of the Fauna client:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Instantiating</span> <span class=nx>the</span> <span class=nx>Fauna</span> <span class=nx>client</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>faunaClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>faunadb</span><span class=p>.</span><span class=nx>Client</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>secret</span><span class=o>:</span> <span class=nx>FAUNA_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>The <code>FAUNA_SECRET</code> environment variable is injected into your application automatically at runtime. Workers run on a custom JavaScript runtime instead of Node.js, so you do not need to use <code>process.env</code> to access your environment variables.</p><h3 id=creating-product-documents><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#creating-product-documents>&#8203;​</a></span>
<span>Creating product documents</span></h3><p>Add your first Worktop route to the <code>index.js</code> file. This route accepts <code>POST</code> requests to the <code>/products</code> endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Creating</span> <span class=nx>product</span> <span class=nx>documents</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;/products&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span><span class=nx>serialNumber</span><span class=p>,</span> <span class=nx>title</span><span class=p>,</span> <span class=nx>weightLbs</span><span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>serialNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>weightLbs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>quantity</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ref</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This route applies an FQL query written in JavaScript that creates a new document in the <strong>Products</strong> collection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Create</span> <span class=nx>query</span> <span class=k>in</span> <span class=nx>FQL</span> <span class=nx>inside</span> <span class=nx>JavaScript</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>Create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>serialNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>weightLbs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>To review what a document looks like, navigate to the <strong>Shell</strong> tab in the Fauna dashboard and run the following query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Create</span> <span class=nx>query</span> <span class=k>in</span> <span class=nx>pure</span> <span class=nx>FQL</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>Create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>serialNumber</span><span class=o>:</span> <span class=s2>&#34;A48432348&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Gaming Console&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>weightLbs</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>Fauna returns the created document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Newly</span> <span class=nx>created</span> <span class=nb>document</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ref</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s2>&#34;Products&#34;</span><span class=p>),</span> <span class=s2>&#34;&lt;document_id&gt;&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>ts</span><span class=o>:</span> <span class=o>&lt;</span><span class=nx>timestamp</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>serialNumber</span><span class=o>:</span> <span class=s2>&#34;A48432348&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Gaming Console&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weightLbs</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>quantity</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><strong>ref</strong> - A <a href="https://docs.fauna.com/fauna/current/api/fql/functions/ref?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>reference</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> to the newly created document.</li><li><strong>ts</strong> - The timestamp of the new document creation in microseconds.</li><li><strong>data</strong> - The actual content of the document.</li></ul><p>Examining the route you create, when the query is successful, the ID of the newly created document is returned in the response body:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Returning</span> <span class=nx>the</span> <span class=k>new</span> <span class=nb>document</span> <span class=nx>ID</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>productId</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ref</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Finally, if Fauna returns any error, an exception is raised by the client. You catch that exception and respond with the result from the <code>getFaunaError()</code> utility function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Handling</span> <span class=nx>any</span> <span class=nx>errors</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=retrieving-product-documents><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#retrieving-product-documents>&#8203;​</a></span>
<span>Retrieving product documents</span></h3><p>Next, create a route that reads a single document from the <strong>Products</strong> collection.</p><p>Add the following route to your <code>index.js</code> file. This route accepts <code>GET</code> requests at the <code>/products/:productId</code> endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Retrieving</span> <span class=nx>product</span> <span class=nx>documents</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;/products/:productId&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Get</span><span class=p>(</span><span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>The FQL query uses the <a href="https://docs.fauna.com/fauna/current/api/fql/functions/get?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Get</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function to retrieve a full document from a document reference:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Retrieving</span> <span class=nx>a</span> <span class=nb>document</span> <span class=nx>by</span> <span class=nx>ID</span> <span class=k>in</span> <span class=nx>FQL</span> <span class=nx>inside</span> <span class=nx>JavaScript</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>Get</span><span class=p>(</span><span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>))</span>
</span></span></code></pre></div><p>If the document exists, return it in the response body:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Returning</span> <span class=nx>the</span> <span class=nb>document</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>response</span> <span class=nx>body</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span></code></pre></div><p>If not, an error is returned.</p><h3 id=deleting-product-documents><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#deleting-product-documents>&#8203;​</a></span>
<span>Deleting product documents</span></h3><p>The logic to delete product documents is similar to the logic for retrieving products. Add the following route to your <code>index.js</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Deleting</span> <span class=nx>product</span> <span class=nx>documents</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;DELETE&#39;</span><span class=p>,</span> <span class=s1>&#39;/products/:productId&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Delete</span><span class=p>(</span><span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>The only difference with the previous route is that you use the <a href="https://docs.fauna.com/fauna/current/api/fql/functions/delete?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Delete</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function to delete a document by providing its reference.</p><p>When the delete operation is successful, Fauna returns the deleted document and the route forwards the deleted document in the response&rsquo;s body. If not, an error is returned.</p><h2 id=testing-and-deploying-your-worker><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#testing-and-deploying-your-worker>&#8203;​</a></span>
<span>Testing and deploying your Worker</span></h2><p>Before deploying your Worker, test it locally by using Wrangler&rsquo;s <a href=/workers/wrangler/cli-wrangler/commands/#dev class=DocsMarkdown--link><span class=DocsMarkdown--link-content>dev</span></a> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Testing</span> <span class=nx>your</span> <span class=nx>Worker</span> <span class=nx>locally</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>wrangler</span> <span class=nx>dev</span>
</span></span></code></pre></div><p>Once the development server is up and running, you can start making HTTP requests to your Worker.</p><p>First, create a new product:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Create a new product
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --data <span class=s1>&#39;{&#34;serialNumber&#34;: &#34;H56N33834&#34;, &#34;title&#34;: &#34;Bluetooth Headphones&#34;, &#34;weightLbs&#34;: 0.5}&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --header <span class=s1>&#39;Content-Type: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --request POST <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http://127.0.0.1:8787/products
</span></span></code></pre></div><p>You should receive a <code>200</code> response similar to the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=err>header:</span> <span class=err>Create</span> <span class=err>product</span> <span class=err>response</span>
</span></span><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;productId&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;document_id&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><aside class=DocsMarkdown--aside role=note data-type=note>Copy the <code>productId</code> value for use in the remaining test queries.</aside><p>Next, read the document you just created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Read a document
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --header <span class=s1>&#39;Content-Type: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --request GET <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http://127.0.0.1:8787/products/&lt;document_id&gt;
</span></span></code></pre></div><p>The response should be the new document serialized to JSON:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=err>header:</span> <span class=err>Read</span> <span class=err>product</span> <span class=err>response</span>
</span></span><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;document_id&gt;&#34;</span><span class=p>,</span><span class=nt>&#34;collection&#34;</span><span class=p>:{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;Products&#34;</span><span class=p>,</span><span class=nt>&#34;collection&#34;</span><span class=p>:{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;collections&#34;</span><span class=p>}}}}}},</span><span class=nt>&#34;ts&#34;</span><span class=p>:</span><span class=mi>1617887459975000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;serialNumber&#34;</span><span class=p>:</span> <span class=s2>&#34;H56N33834&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Bluetooth Headphones&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;weightLbs&#34;</span><span class=p>:</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;quantity&#34;</span><span class=p>:</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, deploy your Worker using the <a href=/workers/wrangler/cli-wrangler/commands/#publish class=DocsMarkdown--link><span class=DocsMarkdown--link-content><code>wrangler publish</code></span></a> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Deploying your Worker
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ wrangler publish
</span></span></code></pre></div><p>This publishes the Worker to your <code>*.workers.dev</code> subdomain.</p><h2 id=updating-inventory-quantity><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#updating-inventory-quantity>&#8203;​</a></span>
<span>Updating inventory quantity</span></h2><p>As the last step, implement a route to update the quantity of a product in your inventory, which is <code>0</code> by default.</p><p>This will present a problem. To calculate the total quantity of a product, you first need to determine how many items there currently are in your inventory. If you solve this in two queries, first reading the quantity and then updating it, the original data might change.</p><p>Fauna solves this by reading and updating the quantity of a product in a single FQL transaction. It is important to mention that all FQL queries are, in fact, transactions. If anything fails, all changes are reverted back thanks to Fauna&rsquo;s ACID properties.</p><p>Add the following route to your <code>index.js</code> file. This route responds to HTTP <code>PATCH</code> requests on the <code>/products/:productId/add-quantity</code> URL endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Updating</span> <span class=nx>inventory</span> <span class=nx>quantity</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;PATCH&#39;</span><span class=p>,</span> <span class=s1>&#39;/products/:productId/add-quantity&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span><span class=nx>quantity</span><span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Let</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>productRef</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=nx>productDocument</span><span class=o>:</span> <span class=nx>Get</span><span class=p>(</span><span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productRef&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>          <span class=nx>currentQuantity</span><span class=o>:</span> <span class=nx>Select</span><span class=p>([</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>],</span> <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productDocument&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>Update</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productRef&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>quantity</span><span class=o>:</span> <span class=nx>Add</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;currentQuantity&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=nx>quantity</span>
</span></span><span class=line><span class=cl>              <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Examine the FQL query in more detail:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Update</span> <span class=nx>query</span> <span class=k>in</span> <span class=nx>FQL</span> <span class=nx>inside</span> <span class=nx>JavaScript</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>Let</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>productRef</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s1>&#39;Products&#39;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>productDocument</span><span class=o>:</span> <span class=nx>Get</span><span class=p>(</span><span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productRef&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentQuantity</span><span class=o>:</span> <span class=nx>Select</span><span class=p>([</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=s1>&#39;quantity&#39;</span><span class=p>],</span> <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productDocument&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>Update</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productRef&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>quantity</span><span class=o>:</span> <span class=nx>Add</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;currentQuantity&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=nx>quantity</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>This query uses the FQL <a href="https://docs.fauna.com/fauna/current/api/fql/functions/let?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Let</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function to set some variables for use later in the query:</p><ul><li><strong>productRef</strong> - The <strong>Ref</strong> of the document to update.</li><li><strong>productDocument</strong> - The full product document that will be updated.</li><li><strong>currentQuantity</strong> - The currently available quantity of the product. You extract the property by using the FQL <a href="https://docs.fauna.com/fauna/current/api/fql/functions/select?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Select</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function.</li></ul><p>You can access the values of variables created by <code>Let</code> in any subsequent FQL expressions by using the FQL <a href="https://docs.fauna.com/fauna/current/api/fql/functions/var?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Var</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function.</p><p>After declaring the variables, <code>Let</code> accepts an FQL expression as a second parameter. This expression is where you update your document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=o>:</span> <span class=nx>Updating</span> <span class=nx>a</span> <span class=nx>product</span> <span class=nb>document</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=nx>Update</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;productRef&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>quantity</span><span class=o>:</span> <span class=nx>Add</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>Var</span><span class=p>(</span><span class=s1>&#39;currentQuantity&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>quantity</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>The FQL <a href="https://docs.fauna.com/fauna/current/api/fql/functions/update?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Update</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function only updates the provided properties of a document. In this example, only the <code>quantity</code> property is updated.</p><p>Finally, this query calculates the new total quantity by adding the value of <code>quantity</code> to <code>currentQuantity</code> using the FQL <a href="https://docs.fauna.com/fauna/current/api/fql/functions/add?lang=shell&utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Add</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> function.</p><aside class=DocsMarkdown--aside role=note data-type=note><div class=DocsMarkdown--aside-header>Consistency guarantees in Fauna</div>Even if multiple Workers update this quantity from different parts of the world, Fauna guarantees the consistency of the data across all Fauna regions. [This article][fauna-blog-consistency-without-clocks] explains how Fauna&rsquo;s distributed protocol works without the need for atomic clocks.</aside><p>Test your update route:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Update product inventory
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --data <span class=s1>&#39;{&#34;quantity&#34;: 5}&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --header <span class=s1>&#39;Content-Type: application/json&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --request PATCH <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http://127.0.0.1:8787/products/&lt;document_id&gt;/add-quantity
</span></span></code></pre></div><p>The response should be the entire updated document with five additional items in the quantity:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=err>header:</span> <span class=err>Update</span> <span class=err>product</span> <span class=err>response</span>
</span></span><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;document_id&gt;&#34;</span><span class=p>,</span><span class=nt>&#34;collection&#34;</span><span class=p>:{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;Products&#34;</span><span class=p>,</span><span class=nt>&#34;collection&#34;</span><span class=p>:{</span><span class=nt>&#34;@ref&#34;</span><span class=p>:{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;collections&#34;</span><span class=p>}}}}}},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ts&#34;</span><span class=p>:</span> <span class=mi>1617890383200000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;serialNumber&#34;</span><span class=p>:</span> <span class=s2>&#34;H56N33834&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Bluetooth Headphones&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;weightLbs&#34;</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;quantity&#34;</span><span class=p>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Update your Worker by publishing it to Cloudflare.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Updating your Worker in Cloudflare
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ wrangler publish
</span></span></code></pre></div><h2 id=complete-code><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#complete-code>&#8203;​</a></span>
<span>Complete code</span></h2><p>At this point, your code should look as follows:</p><h3 id=wranglertoml><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#wranglertoml>&#8203;​</a></span>
<span><code>wrangler.toml</code></span></h3><details><summary>Click to expand</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;fauna-workers&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=p>=</span> <span class=s2>&#34;javascript&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>account_id</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>workers_dev</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nx>route</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>zone_id</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>compatibility_date</span> <span class=p>=</span> <span class=s2>&#34;2021-11-10&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>command</span> <span class=p>=</span> <span class=s2>&#34;npm run build&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>.</span><span class=nx>upload</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>format</span> <span class=p>=</span> <span class=s2>&#34;service-worker&#34;</span>
</span></span></code></pre></div></details><h3 id=indexjs><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#indexjs>&#8203;​</a></span>
<span><code>index.js</code></span></h3><details><summary>Click to expand</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Copyright Fauna, Inc.
</span></span></span><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT-0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Router</span><span class=p>,</span> <span class=nx>listen</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;worktop&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>faunadb</span> <span class=nx>from</span> <span class=s2>&#34;faunadb&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>getFaunaError</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;./utils.js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>faunaClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>faunadb</span><span class=p>.</span><span class=nx>Client</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>secret</span><span class=o>:</span> <span class=nx>FAUNA_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>Create</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Collection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Match</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Get</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Ref</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Paginate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Sum</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Delete</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Add</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Select</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Let</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Var</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Update</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>=</span> <span class=nx>faunadb</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;hello world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=s2>&#34;/products&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>serialNumber</span><span class=p>,</span> <span class=nx>title</span><span class=p>,</span> <span class=nx>weightLbs</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Create</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s2>&#34;Products&#34;</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>serialNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>weightLbs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>quantity</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>productId</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ref</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;/products/:productId&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Get</span><span class=p>(</span><span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s2>&#34;Products&#34;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;DELETE&#34;</span><span class=p>,</span> <span class=s2>&#34;/products/:productId&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>Delete</span><span class=p>(</span><span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s2>&#34;Products&#34;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;PATCH&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;/products/:productId/add-quantity&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>productId</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>productId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>quantity</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>faunaClient</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>Let</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>productRef</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>(</span><span class=nx>Collection</span><span class=p>(</span><span class=s2>&#34;Products&#34;</span><span class=p>),</span> <span class=nx>productId</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>productDocument</span><span class=o>:</span> <span class=nx>Get</span><span class=p>(</span><span class=nx>Var</span><span class=p>(</span><span class=s2>&#34;productRef&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>            <span class=nx>currentQuantity</span><span class=o>:</span> <span class=nx>Select</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=s2>&#34;quantity&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nx>Var</span><span class=p>(</span><span class=s2>&#34;productDocument&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nx>Update</span><span class=p>(</span><span class=nx>Var</span><span class=p>(</span><span class=s2>&#34;productRef&#34;</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>quantity</span><span class=o>:</span> <span class=nx>Add</span><span class=p>(</span><span class=nx>Var</span><span class=p>(</span><span class=s2>&#34;currentQuantity&#34;</span><span class=p>),</span> <span class=nx>quantity</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>faunaError</span> <span class=o>=</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>response</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>faunaError</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span> <span class=nx>faunaError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>listen</span><span class=p>(</span><span class=nx>router</span><span class=p>.</span><span class=nx>run</span><span class=p>);</span>
</span></span></code></pre></div></details><h3 id=utiljs><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#utiljs>&#8203;​</a></span>
<span><code>util.js</code></span></h3><details><summary>Click to expand</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Copyright Fauna, Inc.
</span></span></span><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT-0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>getFaunaError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>description</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>error</span><span class=p>.</span><span class=nx>requestResult</span><span class=p>.</span><span class=nx>responseContent</span><span class=p>.</span><span class=nx>errors</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;unauthorized&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;authentication failed&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>401</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;permission denied&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>403</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;instance not found&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;instance not unique&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;contended transaction&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>409</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>description</span><span class=p>,</span> <span class=nx>status</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></details><h2 id=cleaning-up><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#cleaning-up>&#8203;​</a></span>
<span>Cleaning up</span></h2><p>To remove the resources you create in this tutorial, delete your Worker in the Cloudflare dashboard > <strong>Workers</strong> > <strong>Manage Workers</strong> > <strong>your Worker</strong> > <strong>Settings</strong> > <strong>Delete</strong>:</p><p><img src=./media/delete-worker.png alt="Delete your Worker by following the steps above"></p><p>Finally, delete your Fauna database from its settings in the Fauna dashboard:</p><p><img src=./media/delete-database.png alt="Delete your Fauna database in the Fauna dashboard"></p><h2 id=related-resources><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#related-resources>&#8203;​</a></span>
<span>Related resources</span></h2><p>In this tutorial, you learned how to use Fauna with Cloudflare Workers to create a globally distributed, strongly consistent, next-generation serverless REST API that serves data quickly to a worldwide audience.</p><p>To build your own production-ready applications, refer to the <a href=https://github.com/fauna-labs/fauna-workers class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Fauna Workers quickstart</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>. The quickstart implements suggested practices like a least-privilege security model and business logic encapsulation in user-defined functions.</p><p>If you would like to speak directly with a Fauna expert about building your applications on Cloudflare Workers with Fauna, <a href="https://www2.fauna.com/cloudflare-contact?utm_source=Cloudflare&utm_medium=referral&utm_campaign=Q4_CF_2021" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>contact</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> Fauna.</p></article></div></main><footer class=DocsFooter><div class=DocsFooter--content><div class=DocsFooterResources><span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/workers" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare Dashboard</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://discord.com/invite/cloudflaredev class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Discord</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://community.cloudflare.com/c/developers/workers/40 class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Community</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://www.cloudflare.com/learning/serverless/what-is-serverless/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Learning Center</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/support" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Support Portal</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span></div><div><span class=DocsFooter--edit-on-gh-link-wrapper><a href=https://github.com/panthere2k/panthere2k.github.io/blob/content/content/workers/tutorials/store-data-with-fauna/index.md class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Edit on GitHub</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-time>Updated <time class=relative datetime=2023-01-02T09:58:19+09:00 title=2023-01-02>January 2, 2023</time></span></div></div></footer></div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PKQFGQB")</script><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style></noscript><script defer src=https://unpkg.com/littlefoot/dist/littlefoot.js type=application/javascript></script>
<script type=application/javascript>document.addEventListener("DOMContentLoaded",()=>littlefoot.default())</script></body></html>