<!doctype html><html lang=en theme=light is-docs-page js-focus-visible-polyfill-available><head><meta charset=utf-8><title>How Queues Works · Cloudflare Queues</title><meta http-equiv=cleartype content="on"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=application-name content="How Queues Works · Cloudflare Queues"><meta name=msapplication-tap-highlight content="no"><meta name=apple-mobile-web-app-title content="How Queues Works · Cloudflare Queues"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-capable content="yes"><meta name=mobile-web-app-capable content="yes"><meta name=theme-color content="#f38020"><meta name=description content="Reliably send and receive messages without the egress fees."><meta property="og:image" content="https://panthere2k.github.io/dev-products-preview.png"><meta property="og:title" content="How Queues Works · Cloudflare Queues"><meta property="og:description" content="Reliably send and receive messages without the egress fees."><meta property="og:type" content="website"><meta name=twitter:title content="How Queues Works · Cloudflare Queues"><meta name=twitter:image content="https://panthere2k.github.io/dev-products-preview.png"><meta name=twitter:description content="Reliably send and receive messages without the egress fees."><meta name=twitter:creator content="@cloudflare"><meta name=twitter:card content="summary_large_image"><meta name=pcx_content_type content="concept"><link rel=icon href=/favicon-32x32.png><link rel=canonical href=https://panthere2k.github.io/queues/learning/how-queues-works/><link rel=sitemap href=/sitemap.xml type=application/xml><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon sizes=48x48 href=/icons/icon-48x48.png><link rel=apple-touch-icon sizes=72x72 href=/icons/icon-72x72.png><link rel=apple-touch-icon sizes=96x96 href=/icons/icon-96x96.png><link rel=apple-touch-icon sizes=144x144 href=/icons/icon-144x144.png><link rel=apple-touch-icon sizes=192x192 href=/icons/icon-192x192.png><link rel=apple-touch-icon sizes=256x256 href=/icons/icon-256x256.png><link rel=apple-touch-icon sizes=384x384 href=/icons/icon-384x384.png><link rel=apple-touch-icon sizes=512x512 href=/icons/icon-512x512.png><script src=/search.redirect.min.6828ce878577fe91120d67814d68c0d8.js defer></script><link rel="stylesheet preconnect" href=/style.css><script>(function(){let s=!1,e,n;document.readyState!=="loading"?o():addEventListener("DOMContentLoaded",o),e=document.querySelector("#ThemeToggle"),s=!e;function t(n){try{let o=n?"dark":"light";document.documentElement.setAttribute("theme",o),localStorage.theme=JSON.stringify({theme:o}),e?(e.checked=n,s=!1):s&&setTimeout(t,1,n)}catch{}}function o(){e=e||document.querySelector("#ThemeToggle"),e.addEventListener("change",()=>t(!!e.checked)),addEventListener("keydown",n=>{n.target===document.body&&n.which===68&&n.shiftKey&&(n.preventDefault(),t(!e.checked))})}try{n=window.matchMedia("(prefers-color-scheme:dark)"),n.onchange=e=>t(e.matches)}catch{}try{let e=localStorage.theme,s=e&&JSON.parse(e);t(s?/dark/.test(s.theme):!!(n&&n.matches))}catch{}})()</script><script src=/main.min.c2a5e976c412695a3d9389cba84aa5bd.js defer></script>
<script data-source=docs defer src=https://feedback.developers.cloudflare.com/sdk.js></script>
<link rel=preload href=https://feedback.developers.cloudflare.com/sdk.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://feedback.developers.cloudflare.com/sdk.css></noscript></head><body><div class=DocsPage><div><a class=skip-link href=#main>Skip to content</a></div><div class=DocsMobileHeader><a class="DocsMobileHeader--cloudflare-logo-link Link Link-without-underline" href=/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsMobileTitleHeader><a aria-current=page class="DocsMobileTitleHeader--logo-link Link Link-without-underline" href=/queues/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><span title="Cloudflare Queues logo"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><path d="M11.154 19.894 5.33 14.21l-1.612 1.65 2.656 2.594H1.942a1.442 1.442.0 100 2.884h4.433L3.72 23.927l1.61 1.653 5.823-5.685zm28.352.0-5.823-5.685-1.612 1.65 2.656 2.594h-4.433a1.442 1.442.0 100 2.884h4.433l-2.655 2.591 1.611 1.651 5.823-5.685z"/><rect width="23.07" height="2.884" x="7.911" y="7" rx="1.442"/><rect width="23.07" height="2.884" x="7.911" y="30.07" rx="1.442"/><path d="M13.679 14.21c.796.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.646-1.443 1.442-1.443zm5.767.0c.797.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.646-1.443 1.442-1.443zm5.768.0c.796.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.645-1.443 1.442-1.443z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:6>Queues</span></span></div></a><button class="Button DocsMobileTitleHeader--sidebar-toggle-button">
<span class=DocsMobileTitleHeader--sidebar-toggle-button-icon aria-hidden=true><svg viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="title-1332672649688018" xmlns="http://www.w3.org/2000/svg"><title id="title-1332672649688018">Navigation menu icon</title><path data-index="1" d="M5 7h10" transform-origin="10 7"/><path data-index="2" d="M5 10h10" transform-origin="10 10"/><path data-index="3" d="M5 13h10" transform-origin="10 13"/></svg><span is-visually-hidden>Open external link</span></span></button></div><div class=DocsMobileNavBackdrop></div><div class=DocsSidebar><div class=DocsSidebar--sections><div class="DocsSidebar--section DocsSidebar--header-section"><a class="DocsSidebar--cloudflare-logo-link DocsSidebar--link" href=/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsSidebar--section-separator></div><div class="DocsSidebar--section DocsSidebar--docs-title-section"><a aria-current=page class="DocsSidebar--docs-title-logo-link DocsSidebar--link" href=/queues/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><span title="Cloudflare Queues logo"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><path d="M11.154 19.894 5.33 14.21l-1.612 1.65 2.656 2.594H1.942a1.442 1.442.0 100 2.884h4.433L3.72 23.927l1.61 1.653 5.823-5.685zm28.352.0-5.823-5.685-1.612 1.65 2.656 2.594h-4.433a1.442 1.442.0 100 2.884h4.433l-2.655 2.591 1.611 1.651 5.823-5.685z"/><rect width="23.07" height="2.884" x="7.911" y="7" rx="1.442"/><rect width="23.07" height="2.884" x="7.911" y="30.07" rx="1.442"/><path d="M13.679 14.21c.796.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.646-1.443 1.442-1.443zm5.767.0c.797.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.646-1.443 1.442-1.443zm5.768.0c.796.0 1.442.645 1.442 1.441v8.651a1.442 1.442.0 11-2.884.0v-8.65c0-.797.645-1.443 1.442-1.443z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:6>Queues</span></span></div></a><div class="DocsSidebar--section-more Dropdown" data-expanded=false><button class="DocsSidebar--section-more-button Button" aria-expanded=false><div class=DocsSidebar--section-more-button-icon><svg viewBox="0 0 4 16" stroke="currentcolor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" fill="currentcolor" role="img" aria-labelledby="title-6032186738345315" xmlns="http://www.w3.org/2000/svg"><title id="title-6032186738345315">Dropdown icon</title><path d="M2 2v0m0 6v0m0 6v0z"/></svg><span is-visually-hidden>Queues menu</span></div></button><div class="DocsSidebar--section-more-dropdown Dropdown--dropdown"><ul class=Dropdown--list></ul></div></div></div><div class="DocsSidebar--section DocsSidebar--nav-section" style=position:relative;overflow:hidden;width:100%;height:100%><div style=position:absolute;inset:0;overflow-y:auto;margin-right:0;margin-bottom:0><div class=DocsSidebar--nav-section-shadow style=opacity:0></div><ul class=DocsSidebar--nav><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Overview</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/get-started/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Guide</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Examples</span>
</button><a class=DocsSidebar--nav-link href=/queues/examples/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Examples</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/examples/send-errors-to-r2/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Using Queues to store data in R2</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Learning</span>
</button><a class=DocsSidebar--nav-link href=/queues/learning/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Learning</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style=min-height:0;transition-duration:400ms is-expanded><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item is-active><a aria-current=page class=DocsSidebar--nav-link href=/queues/learning/how-queues-works/ is-active><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How Queues Works</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/learning/delivery-guarantees/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Delivery guarantees</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/learning/batching-retries/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Batching and Retries</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/javascript-apis/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>JavaScript APIs</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/configuration/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Configuration</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/limits/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Limits</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/pricing/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Pricing</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/queues/changelog/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Changelog</span></a></li></ul></div><div style=position:absolute;height:6px;display:none;right:2px;bottom:2px;left:2px;border-radius:3px><div style=position:relative;display:block;height:100%;cursor:pointer;border-radius:inherit;background-color:rgba(0,0,0,.2)></div></div><div style=position:absolute;width:6px;display:none class="Scrollbars--track Scrollbars--track-vertical"><div style=position:relative;display:block;width:100% class="Scrollbars--thumb Scrollbars--thumb-vertical"></div></div></div><div class=toggleSidebar><button id=toggleSidebarButton style=width:2em;height:2em title="Click to collapse and expand the sidebar navigation"><svg id="toggleSidebarSVG" aria-hidden="true" height="1" width="1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path id="toggleSidebarSVGPath" d="M15 2a1 1 0 00-1 1v10a1 1 0 002 0V3a1 1 0 00-1-1zm-10.407.993-4.3 4.3a1 1 0 000 1.414l4.3 4.3a1 1 0 001.415-1.416L3.417 9H10a1 1 0 100-2H3.417l2.591-2.591A1 1 0 104.593 2.993z"/></svg></button></div></div><div class=DocsSidebar--shadow></div></div><div class=DocsToolbar><div class=DocsToolbar--search><div class=DocsSearch><div class=DocsSearch--input-wrapper><input type=text id=DocsSearch--input class=DocsSearch--input spellcheck=false autocomplete=false placeholder="Search docs..."><div class=DocsSearch--input-icon><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-9701125841014673" xmlns="http://www.w3.org/2000/svg"><title id="title-9701125841014673">Search icon (depiction of a magnifying glass)</title><path d="M11.999 10.585l3.458 3.458a1 1 0 01-1.414 1.414L10.585 12a6.5 6.5.0 111.414-1.414zM6.75 11.5a4.75 4.75.0 100-9.5 4.75 4.75.0 000 9.5z"/></svg></div><button disabled class=slashPlaceholder title="Press '/' to focus on the search bar" aria-label="Forward slash keyboard shortcut" tabindex=-1 type=button><div style=margin-top:-1px>/</span></div></button></div></div></div><div class=DocsToolbar--tools><button data-feedback=true class="DocsToolbar--feedback Button Button-is-docs-secondary">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><path d="M14 2.5H2l-.5.5v11.165l.863.345 2.852-3.01H14l.5-.5V3l-.5-.5zm-.5 8H4.785L2.5 12.911V3.5h11v7z" fill="currentcolor"/><path d="M12.5 5.003h-9v1h9v-1zm0 2.497h-9v1h9v-1z" fill="currentcolor"/></svg>Give Feedback</button><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--tools-icon-item><div class=Tooltip---root><div class=DocsToolbar--tools-icon-item-content><a class="Link Link-without-underline" href=https://github.com/cloudflare/cloudflare-docs><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-6991762763429039" xmlns="http://www.w3.org/2000/svg"><title id="title-6991762763429039">GitHub icon</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" fill-rule="evenodd"/></svg></a></div><span class=Tooltip role=tooltip position=bottom-end>Visit Queues on GitHub</span></div></div><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--theme-toggle><div class=Tooltip---root><div class=ThemeToggle><input type=checkbox id=ThemeToggle class=ThemeToggle--input>
<label class=ThemeToggle--toggle for=ThemeToggle><div class=ThemeToggle--toggle-handle></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--sun"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-8812071124069258" xmlns="http://www.w3.org/2000/svg"><title id="title-8812071124069258">Light theme icon (depiction of a sun)</title><path d="M7.5 11.465a3.482 3.482.0 01-1.596-.662L4.11 12.596a.5.5.0 01-.707-.707l1.793-1.793A3.482 3.482.0 014.535 8.5H2a.5.5.0 010-1h2.535a3.482 3.482.0 01.662-1.596L3.404 4.11a.5.5.0 01.707-.707l1.793 1.793A3.482 3.482.0 017.5 4.535V2a.5.5.0 011 0v2.535a3.482 3.482.0 011.596.662l1.793-1.793a.5.5.0 01.707.707l-1.793 1.793c.343.458.577 1.003.662 1.596H14a.5.5.0 110 1h-2.535a3.482 3.482.0 01-.662 1.596l1.793 1.793a.5.5.0 01-.707.707l-1.793-1.793a3.482 3.482.0 01-1.596.662V14a.5.5.0 11-1 0v-2.535z"/></svg></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--moon"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-5971296394189265" xmlns="http://www.w3.org/2000/svg"><title id="title-5971296394189265">Dark theme icon (depiction of a moon)</title><path d="M7.067 3.087a5 5 0 005.466 7.026A5 5 0 117.067 3.087z"/></svg></div></label><span class=Tooltip role=tooltip position=bottom-end>Set theme to dark (⇧+D)</span></div></div></div></div></div><main class=DocsBody><div class=DocsBody--sidebar with-styled-webkit-scrollbars><div class=DocsBody--sidebar-content-scroll-fade></div><div class=DocsBody--sidebar-content><ul class=DocsTableOfContents hidden><li><a class=DocsTableOfContents-link href=#docs-content>↑ Top</a></li></ul></nav></div></div><div id=docs-content data-reach-skip-nav-content></div><div class=DocsContent id=main page-type=document><article class=DocsMarkdown><h1 id=how-queues-works>How Queues works</h1><p>Cloudflare Queues is a flexible messaging queue that allows you to queue messages for asynchronous processing. Message queues are great at decoupling components of applications, like the checkout and order fulfillment services for an e-commerce site. Decoupled services are easier to reason about, deploy, and implement, allowing you to ship features that delight your customers without worrying about synchronizing complex deployments. Queues also allow you to batch and buffer calls to downstream services and APIs.</p><p>There are four major concepts to understand with Queues:</p><ol><li><a href=#what-is-a-queue class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Queues</span></a></li><li><a href=#producers class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Producers</span></a></li><li><a href=#consumers class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Consumers</span></a></li><li><a href=#messages class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Messages</span></a></li></ol><h2 id=what-is-a-queue><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#what-is-a-queue>&#8203;​</a></span>
<span>What is a queue</span></h2><p>A queue is a buffer or list that automatically scales as messages are written to it, and allows a consumer Worker to pull messages from that same queue.</p><p>Queues are designed to be reliable, and messages written to a queue should never be lost once the write succeeds. Similarly, messages are not deleted from a queue until the <a href=#consumer class=DocsMarkdown--link><span class=DocsMarkdown--link-content>consumer</span></a> has successfully consumed the message.</p><p>Developers can create multiple queues. Creating multiple queues can be useful to:</p><ul><li>Separate different use-cases and processing requirements: for example, a logging queue vs. a password reset queue.</li><li>Horizontally scale your overall throughput (messages per second) by using multiple queues to scale out.</li><li>Configure different batching strategies for each consumer connected to a queue.</li></ul><p>For most applications, a single producer Worker per queue, with each producer writing to multiple queues is easier to manage, and allows you to logically separate the processing for each of your queues.</p><h2 id=producers><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#producers>&#8203;​</a></span>
<span>Producers</span></h2><p>A producer is the term for a client that is publishing or producing messages on to a queue. A producer is configured by <a href=https://developers.cloudflare.com/workers/platform/bindings/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>binding</span></a> a queue to a Worker and writing messages to the queue by calling that binding.</p><p>For example, if we bound a queue named <code>my-first-queue</code> to a binding of <code>MY_FIRST_QUEUE</code>, messages can be written to the queue by calling <code>.send()</code> on the binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>req</span>: <span class=kt>Request</span><span class=p>,</span> <span class=nx>env</span>: <span class=kt>Environment</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>Response</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=nx>env</span><span class=p>.</span><span class=nx>MY_FIRST_QUEUE</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=c1>// This will throw an exception if the send fails for any reason
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>A queue can have multiple producers. For example, you may have multiple Workers writing events or logs to a shared queue based on incoming HTTP requests from users. There is no limit to the total number of producer Workers that can write to a single queue. Additionally, multiple queues can be bound to a single Worker. That single Worker can decide which queue to write to (or write to multiple) based on any logic you define in your code.</p><h2 id=consumers><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#consumers>&#8203;​</a></span>
<span>Consumers</span></h2><p>A consumer is the term for a client that is subscribing to or <em>consuming</em> messages from a queue. In its most basic form, a consumer is defined by creating a <code>queue</code> handler in a Worker:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>queue</span><span class=p>(</span><span class=nx>batch</span>: <span class=kt>MessageBatch</span><span class=p>&lt;</span><span class=nt>Error</span><span class=p>&gt;,</span> <span class=nx>env</span>: <span class=kt>Environment</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Do something with messages in the batch
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// i.e. write to R2 storage, D1 database, or POST to an external API 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// You can also iterate over each message in the batch by looping over batch.messages
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>You then connect that consumer to a queue with <code>wrangler queues consumer &lt;queue-name> &lt;worker-script-name></code> or by defining a <code>[[queues.consumers]]</code> configuration in your <code>wrangler.toml</code> manually:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>---</span>
</span></span><span class=line><span class=cl><span class=nx>filename</span><span class=err>:</span> <span class=nx>wrangler</span><span class=p>.</span><span class=nx>toml</span>
</span></span><span class=line><span class=cl><span class=nx>---</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>queues</span><span class=p>.</span><span class=nx>consumers</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>  <span class=nx>queue</span> <span class=p>=</span> <span class=s2>&#34;&lt;your-queue-name&gt;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nx>max_batch_size</span> <span class=p>=</span> <span class=mi>100</span> <span class=c># optional</span>
</span></span><span class=line><span class=cl>  <span class=nx>max_batch_timeout</span> <span class=p>=</span> <span class=mi>30</span> <span class=c># optional</span>
</span></span></code></pre></div><p>Importantly, each queue can only have one active consumer. This allows Cloudflare Queues to achieve at least once delivery and minimize the risk of duplicate messages beyond that.</p><p>Notably, you can use the same consumer with multiple queues. The queue handler that defines your consumer Worker will be invoked by the queues it is connected to.</p><ul><li>The <code>MessageBatch</code> that is passed to your <code>queue</code> handler includes a <code>queue</code> property with the name of the queue the batch was read from.</li><li>This can reduce the amount of code you need to write, and allow you to process messages based on the name of your queues.</li></ul><p>For example, a consumer configured to consume messages from multiple queues would resemble the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>queue</span><span class=p>(</span><span class=nx>batch</span>: <span class=kt>MessageBatch</span><span class=p>&lt;</span><span class=nt>Error</span><span class=p>&gt;,</span> <span class=nx>env</span>: <span class=kt>Environment</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// MessageBatch has a `queue` property we can switch on
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>switch</span> <span class=p>(</span><span class=nx>batch</span><span class=p>.</span><span class=nx>queue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;log-queue&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Write the batch to R2
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;debug-queue&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Write the message to the console or to another queue
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;email-reset&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Trigger a password reset email via an external API
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Handle messages we haven&#39;t mentioned explicitly (write a log, push to a DLQ)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=messages><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#messages>&#8203;​</a></span>
<span>Messages</span></h2><p>A message is the object you are producing to and consuming from a queue. Any serializable object can be published to a queue: for most developers, this means either simple strings or JSON objects.</p><p>Messages themselves can be batched when delivered to the consumer, and messages within a batch are treated as all or nothing when determining retries. If the last message in a batch fails to be processed, the entire batch will be retried.</p></article></div></main><footer class=DocsFooter><div class=DocsFooter--content><div class=DocsFooterResources><span class=DocsFooter--content-additional-wrapper><a href=https://dash.cloudflare.com class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare Dashboard</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://discord.com/channels/595317990191398933/1008691665688604783 class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Discord</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://community.cloudflare.com/c/developers/workers/40 class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Community</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://www.cloudflare.com/learning/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Learning Center</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/support" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Support Portal</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span></div><div><span class=DocsFooter--edit-on-gh-link-wrapper><a href=https://github.com/panthere2k/panthere2k.github.io/blob/content/content/queues/learning/how-queues-works.md class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Edit on GitHub</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-time>Updated <time class=relative datetime=2023-01-02T09:58:19+09:00 title=2023-01-02>January 2, 2023</time></span></div></div></footer></div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PKQFGQB")</script><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style></noscript><script defer src=https://unpkg.com/littlefoot/dist/littlefoot.js type=application/javascript></script>
<script type=application/javascript>document.addEventListener("DOMContentLoaded",()=>littlefoot.default())</script></body></html>