<!doctype html><html lang=en theme=light is-docs-page js-focus-visible-polyfill-available><head><meta charset=utf-8><title>Aruba EdgeConnect Enterprise · Cloudflare Magic WAN docs</title><meta http-equiv=cleartype content="on"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=application-name content="Aruba EdgeConnect Enterprise · Cloudflare Magic WAN docs"><meta name=msapplication-tap-highlight content="no"><meta name=apple-mobile-web-app-title content="Aruba EdgeConnect Enterprise · Cloudflare Magic WAN docs"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-capable content="yes"><meta name=mobile-web-app-capable content="yes"><meta name=theme-color content="#f38020"><meta name=description content="Magic WAN replaces legacy WAN architectures with Cloudflare’s network, providing global connectivity, cloud-based security, performance, and control through one simple user interface."><meta property="og:image" content="https://panthere2k.github.io/zt-preview.png"><meta property="og:title" content="Aruba EdgeConnect Enterprise · Cloudflare Magic WAN docs"><meta property="og:description" content="Magic WAN replaces legacy WAN architectures with Cloudflare’s network, providing global connectivity, cloud-based security, performance, and control through one simple user interface."><meta property="og:type" content="website"><meta name=twitter:title content="Aruba EdgeConnect Enterprise · Cloudflare Magic WAN docs"><meta name=twitter:image content="https://panthere2k.github.io/zt-preview.png"><meta name=twitter:description content="Magic WAN replaces legacy WAN architectures with Cloudflare’s network, providing global connectivity, cloud-based security, performance, and control through one simple user interface."><meta name=twitter:creator content="@cloudflare"><meta name=twitter:card content="summary_large_image"><meta name=pcx_content_type content="tutorial"><link rel=icon href=/favicon-32x32.png><link rel=canonical href=https://panthere2k.github.io/magic-wan/tutorials/aruba-edgeconnect/><link rel=sitemap href=/sitemap.xml type=application/xml><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon sizes=48x48 href=/icons/icon-48x48.png><link rel=apple-touch-icon sizes=72x72 href=/icons/icon-72x72.png><link rel=apple-touch-icon sizes=96x96 href=/icons/icon-96x96.png><link rel=apple-touch-icon sizes=144x144 href=/icons/icon-144x144.png><link rel=apple-touch-icon sizes=192x192 href=/icons/icon-192x192.png><link rel=apple-touch-icon sizes=256x256 href=/icons/icon-256x256.png><link rel=apple-touch-icon sizes=384x384 href=/icons/icon-384x384.png><link rel=apple-touch-icon sizes=512x512 href=/icons/icon-512x512.png><script src=/search.redirect.min.6828ce878577fe91120d67814d68c0d8.js defer></script><link rel="stylesheet preconnect" href=/style.css><script>(function(){let s=!1,e,n;document.readyState!=="loading"?o():addEventListener("DOMContentLoaded",o),e=document.querySelector("#ThemeToggle"),s=!e;function t(n){try{let o=n?"dark":"light";document.documentElement.setAttribute("theme",o),localStorage.theme=JSON.stringify({theme:o}),e?(e.checked=n,s=!1):s&&setTimeout(t,1,n)}catch{}}function o(){e=e||document.querySelector("#ThemeToggle"),e.addEventListener("change",()=>t(!!e.checked)),addEventListener("keydown",n=>{n.target===document.body&&n.which===68&&n.shiftKey&&(n.preventDefault(),t(!e.checked))})}try{n=window.matchMedia("(prefers-color-scheme:dark)"),n.onchange=e=>t(e.matches)}catch{}try{let e=localStorage.theme,s=e&&JSON.parse(e);t(s?/dark/.test(s.theme):!!(n&&n.matches))}catch{}})()</script><script src=/main.min.c2a5e976c412695a3d9389cba84aa5bd.js defer></script>
<script data-source=docs defer src=https://feedback.developers.cloudflare.com/sdk.js></script>
<link rel=preload href=https://feedback.developers.cloudflare.com/sdk.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://feedback.developers.cloudflare.com/sdk.css></noscript></head><body><div class=DocsPage><div><a class=skip-link href=#main>Skip to content</a></div><div class=DocsMobileHeader><a class="DocsMobileHeader--cloudflare-logo-link Link Link-without-underline" href=/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsMobileTitleHeader><a aria-current=page class="DocsMobileTitleHeader--logo-link Link Link-without-underline" href=/magic-wan/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><span title="Cloudflare Magic WAN logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M43.5 22.5H31.567l11.003-4.575-1.148-2.775-11.047 4.56 8.453-8.46-2.123-2.123-8.415 8.423 4.575-10.988-2.775-1.155-4.59 11.04V4.5h-3v11.895L18 5.393 15.225 6.54l4.56 11.047-8.49-8.452-2.123 2.115 8.415 8.422L6.6 15.105l-1.155 2.767L16.5 22.5h-12v3h11.933L5.43 30l1.147 2.775 11.048-4.56-8.453 8.452 2.123 2.123 8.415-8.415-4.575 10.987 2.775 1.155L22.5 31.5v11.932h3V31.5L30 42.502l2.775-1.14-4.522-11.025 8.452 8.453 2.123-2.123-8.416-8.415L41.4 32.828l1.155-2.776L31.5 25.5h12v-3zm-12 0v3l-1.14 2.76-2.107 2.107-2.753 1.088h-3l-2.753-1.14-2.107-2.108-1.14-2.76V22.5l1.14-2.76 2.107-2.107L22.5 16.5h3l2.753 1.14 2.107 2.107L31.5 22.5z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:9>Magic WAN</span></span></div></a><button class="Button DocsMobileTitleHeader--sidebar-toggle-button">
<span class=DocsMobileTitleHeader--sidebar-toggle-button-icon aria-hidden=true><svg viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="title-1332672649688018" xmlns="http://www.w3.org/2000/svg"><title id="title-1332672649688018">Navigation menu icon</title><path data-index="1" d="M5 7h10" transform-origin="10 7"/><path data-index="2" d="M5 10h10" transform-origin="10 10"/><path data-index="3" d="M5 13h10" transform-origin="10 13"/></svg><span is-visually-hidden>Open external link</span></span></button></div><div class=DocsMobileNavBackdrop></div><div class=DocsSidebar><div class=DocsSidebar--sections><div class="DocsSidebar--section DocsSidebar--header-section"><a class="DocsSidebar--cloudflare-logo-link DocsSidebar--link" href=/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsSidebar--section-separator></div><div class="DocsSidebar--section DocsSidebar--docs-title-section"><a aria-current=page class="DocsSidebar--docs-title-logo-link DocsSidebar--link" href=/magic-wan/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><span title="Cloudflare Magic WAN logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M43.5 22.5H31.567l11.003-4.575-1.148-2.775-11.047 4.56 8.453-8.46-2.123-2.123-8.415 8.423 4.575-10.988-2.775-1.155-4.59 11.04V4.5h-3v11.895L18 5.393 15.225 6.54l4.56 11.047-8.49-8.452-2.123 2.115 8.415 8.422L6.6 15.105l-1.155 2.767L16.5 22.5h-12v3h11.933L5.43 30l1.147 2.775 11.048-4.56-8.453 8.452 2.123 2.123 8.415-8.415-4.575 10.987 2.775 1.155L22.5 31.5v11.932h3V31.5L30 42.502l2.775-1.14-4.522-11.025 8.452 8.453 2.123-2.123-8.416-8.415L41.4 32.828l1.155-2.776L31.5 25.5h12v-3zm-12 0v3l-1.14 2.76-2.107 2.107-2.753 1.088h-3l-2.753-1.14-2.107-2.108-1.14-2.76V22.5l1.14-2.76 2.107-2.107L22.5 16.5h3l2.753 1.14 2.107 2.107L31.5 22.5z"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:9>Magic WAN</span></span></div></a><div class="DocsSidebar--section-more Dropdown" data-expanded=false><button class="DocsSidebar--section-more-button Button" aria-expanded=false><div class=DocsSidebar--section-more-button-icon><svg viewBox="0 0 4 16" stroke="currentcolor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" fill="currentcolor" role="img" aria-labelledby="title-6032186738345315" xmlns="http://www.w3.org/2000/svg"><title id="title-6032186738345315">Dropdown icon</title><path d="M2 2v0m0 6v0m0 6v0z"/></svg><span is-visually-hidden>Magic WAN menu</span></div></button><div class="DocsSidebar--section-more-dropdown Dropdown--dropdown"><ul class=Dropdown--list><li class=Dropdown--item><a class=Dropdown--link href=https://www.cloudflare.com/magic-wan/ tabindex=-1>Magic WAN home</a></li><li class=Dropdown--item><a class=Dropdown--link href=https://blog.cloudflare.com/magic-wan-firewall/ tabindex=-1>Blog: Magic WAN & Magic Firewall</a></li><li class=Dropdown--item><a class=Dropdown--link href=https://cloudflare.com tabindex=-1>Cloudflare homepage</a></li></ul></div></div></div><div class="DocsSidebar--section DocsSidebar--nav-section" style=position:relative;overflow:hidden;width:100%;height:100%><div style=position:absolute;inset:0;overflow-y:auto;margin-right:0;margin-bottom:0><div class=DocsSidebar--nav-section-shadow style=opacity:0></div><ul class=DocsSidebar--nav><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Overview</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: About</span>
</button><a class=DocsSidebar--nav-link href=/magic-wan/about/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>About</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/about/health-checks/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Health checks</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/about/traffic-steering/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Traffic steering</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/about/tunnels-and-encapsulation/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Tunnels & encapsulation</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/prerequisites/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Prerequisites</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/get-started/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Get started</span></a></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: How to</span>
</button><a class=DocsSidebar--nav-link href=/magic-wan/how-to/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>How to</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/configure-tunnels/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Configure tunnel endpoints</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/configure-static-routes/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Configure static routes</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/run-endpoint-health-checks/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Run endpoint health checks</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/view-analytics/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>View Network Analytics</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/enable-magic-roles/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Enable Magic user roles</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/how-to/ipsec/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Set up IPsec tunnels</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Tutorials</span>
</button><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Tutorials</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style=min-height:0;transition-duration:400ms is-expanded><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item is-active><a aria-current=page class=DocsSidebar--nav-link href=/magic-wan/tutorials/aruba-edgeconnect/ is-active><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Aruba EdgeConnect Enterprise</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/viptela/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Cisco Viptela SD-WAN</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/cisco-ios-xe/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Cisco IOS XE</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/secure-web-gateway/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Cloudflare Gateway</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/fortinet/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Fortinet</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/pfsense/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>pfSense</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/strongswan/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>strongSwan</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/vyos/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>VyOS</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/tutorials/warp/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>WARP</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Reference</span>
</button><a class=DocsSidebar--nav-link href=/magic-wan/reference/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Reference</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/magic-wan/reference/device-compatibility/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Device compatibility</span></a></li></ul></div></div></div></div></li></ul></div><div style=position:absolute;height:6px;display:none;right:2px;bottom:2px;left:2px;border-radius:3px><div style=position:relative;display:block;height:100%;cursor:pointer;border-radius:inherit;background-color:rgba(0,0,0,.2)></div></div><div style=position:absolute;width:6px;display:none class="Scrollbars--track Scrollbars--track-vertical"><div style=position:relative;display:block;width:100% class="Scrollbars--thumb Scrollbars--thumb-vertical"></div></div></div><div class=toggleSidebar><button id=toggleSidebarButton style=width:2em;height:2em title="Click to collapse and expand the sidebar navigation"><svg id="toggleSidebarSVG" aria-hidden="true" height="1" width="1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path id="toggleSidebarSVGPath" d="M15 2a1 1 0 00-1 1v10a1 1 0 002 0V3a1 1 0 00-1-1zm-10.407.993-4.3 4.3a1 1 0 000 1.414l4.3 4.3a1 1 0 001.415-1.416L3.417 9H10a1 1 0 100-2H3.417l2.591-2.591A1 1 0 104.593 2.993z"/></svg></button></div></div><div class=DocsSidebar--shadow></div></div><div class=DocsToolbar><div class=DocsToolbar--search><div class=DocsSearch><div class=DocsSearch--input-wrapper><input type=text id=DocsSearch--input class=DocsSearch--input spellcheck=false autocomplete=false placeholder="Search docs..."><div class=DocsSearch--input-icon><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-9701125841014673" xmlns="http://www.w3.org/2000/svg"><title id="title-9701125841014673">Search icon (depiction of a magnifying glass)</title><path d="M11.999 10.585l3.458 3.458a1 1 0 01-1.414 1.414L10.585 12a6.5 6.5.0 111.414-1.414zM6.75 11.5a4.75 4.75.0 100-9.5 4.75 4.75.0 000 9.5z"/></svg></div><button disabled class=slashPlaceholder title="Press '/' to focus on the search bar" aria-label="Forward slash keyboard shortcut" tabindex=-1 type=button><div style=margin-top:-1px>/</span></div></button></div></div></div><div class=DocsToolbar--tools><button data-feedback=true class="DocsToolbar--feedback Button Button-is-docs-secondary">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><path d="M14 2.5H2l-.5.5v11.165l.863.345 2.852-3.01H14l.5-.5V3l-.5-.5zm-.5 8H4.785L2.5 12.911V3.5h11v7z" fill="currentcolor"/><path d="M12.5 5.003h-9v1h9v-1zm0 2.497h-9v1h9v-1z" fill="currentcolor"/></svg>Give Feedback</button><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--tools-icon-item><div class=Tooltip---root><div class=DocsToolbar--tools-icon-item-content><a class="Link Link-without-underline" href=https://github.com/cloudflare/cloudflare-docs><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-6991762763429039" xmlns="http://www.w3.org/2000/svg"><title id="title-6991762763429039">GitHub icon</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" fill-rule="evenodd"/></svg></a></div><span class=Tooltip role=tooltip position=bottom-end>Visit Magic WAN on GitHub</span></div></div><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--theme-toggle><div class=Tooltip---root><div class=ThemeToggle><input type=checkbox id=ThemeToggle class=ThemeToggle--input>
<label class=ThemeToggle--toggle for=ThemeToggle><div class=ThemeToggle--toggle-handle></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--sun"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-8812071124069258" xmlns="http://www.w3.org/2000/svg"><title id="title-8812071124069258">Light theme icon (depiction of a sun)</title><path d="M7.5 11.465a3.482 3.482.0 01-1.596-.662L4.11 12.596a.5.5.0 01-.707-.707l1.793-1.793A3.482 3.482.0 014.535 8.5H2a.5.5.0 010-1h2.535a3.482 3.482.0 01.662-1.596L3.404 4.11a.5.5.0 01.707-.707l1.793 1.793A3.482 3.482.0 017.5 4.535V2a.5.5.0 011 0v2.535a3.482 3.482.0 011.596.662l1.793-1.793a.5.5.0 01.707.707l-1.793 1.793c.343.458.577 1.003.662 1.596H14a.5.5.0 110 1h-2.535a3.482 3.482.0 01-.662 1.596l1.793 1.793a.5.5.0 01-.707.707l-1.793-1.793a3.482 3.482.0 01-1.596.662V14a.5.5.0 11-1 0v-2.535z"/></svg></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--moon"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-5971296394189265" xmlns="http://www.w3.org/2000/svg"><title id="title-5971296394189265">Dark theme icon (depiction of a moon)</title><path d="M7.067 3.087a5 5 0 005.466 7.026A5 5 0 117.067 3.087z"/></svg></div></label><span class=Tooltip role=tooltip position=bottom-end>Set theme to dark (⇧+D)</span></div></div></div></div></div><main class=DocsBody><div class=DocsBody--sidebar with-styled-webkit-scrollbars><div class=DocsBody--sidebar-content-scroll-fade></div><div class=DocsBody--sidebar-content><ul class=DocsTableOfContents hidden><li><a class=DocsTableOfContents-link href=#docs-content>↑ Top</a></li></ul></nav></div></div><div id=docs-content data-reach-skip-nav-content></div><div class=DocsContent id=main page-type=document><article class=DocsMarkdown><h1 id=aruba-edgeconnect-enterprise>Aruba EdgeConnect Enterprise</h1><p>Cloudflare partners with Aruba’s EdgeConnect SD-WAN solution to provide users with an integrated solution. The EdgeConnect appliances manage subnets associated with branch offices or retail locations. Anycast tunnels are set up between the EdgeConnect appliances and Cloudflare to securely route traffic.</p><p>This tutorial describes how to configure the EdgeConnect device for both east-west (branch to branch) and north-south (Internet-bound) use cases.</p><aside class=DocsMarkdown--aside role=note data-type=warning>Note that north-south traffic routed through Cloudflare’s Secure Web Gateway is an optional add-on feature set and requires a Cloudflare Zero Trust account.</aside><h3 id=prerequisites><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#prerequisites>&#8203;​</a></span>
<span>Prerequisites</span></h3><p>Before setting up a connection between EdgeConnect and Cloudflare, you must have:</p><ul><li>A contract that includes Magic WAN and Secure Web Gateway.</li><li>Received two Cloudflare endpoints (Anycast IP address).</li><li>Determined a private static /31 IP pair to use with each tunnel. The /31 pairs should be from a different private subnet, separate from the private subnets used behind each EdgeConnect appliance.</li><li>The EdgeConnect devices used in this tutorial and on v9.0.</li></ul><h2 id=example-scenario><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#example-scenario>&#8203;​</a></span>
<span>Example scenario</span></h2><details><summary>GRE tunnel configuration</summary><div class=special-class markdown=1><p>For the purpose of this tutorial, the integration will refer to a scenario with two branch offices, each with distinct subnets.</p><p>There are 2 branch offices each with distinct subnets.</p><ul><li>The east branch office has a 10.3.0.0/16 network with an EdgeConnect terminating the Anycast GRE tunnel.</li><li>The west branch office has a 10.30.0.0/16 network with an EdgeConnect terminating the Anycast GRE tunnel.</li></ul><p><img src=/magic-wan/static/branch-subnets.png alt="Table of branch subnet information"></p><p>Below is an example of the <strong>east_branch</strong> deployment on the Orchestrator.</p><p><img src=/magic-wan/static/east-branch-deployment.png alt="GCP East deployment configuraiton"></p><p>The Deployment screenshot displays several different IP addresses and interfaces. From left to right:</p><ul><li><strong>Next Hop 10.3.0.1</strong> - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.</li><li><strong>IP/Mask (LAN) 10.3.0.2/24</strong> - This defines the LAN0 interface IP of the EdgeConnect appliance.</li><li><strong>IP/Mask (WAN) 10.2.0.2/24</strong> - This defines the WAN0 interface IP of the EdgeConnect appliance.</li><li><strong>Next Hop 10.2.0.1</strong> - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.</li></ul></div></details><details><summary>IPsec tunnel configuration</summary><div class=special-class markdown=1><p>For the purpose of this tutorial, the integration will refer to a scenario with two branch offices, each with distinct subnets.</p><p>The central branch office has a 10.22.0.0/24 network with an EdgeConnect terminating the
Anycast IPSec tunnel.</p><p>The west branch office has a 10.77.0.0/24 network with an EdgeConnect terminating the
Anycast IPSec tunnel.</p><p><img src=/magic-wan/static/central-west-branch-ipsec.png alt="IPsec tunnel values for east and west branches"></p><p>Below is an example of the <strong>central_branch</strong> deployment on the Orchestrator.</p><p><img src=/magic-wan/static/orchestrator-ipsec.png alt="Values for central branch configuration within Orchestrator"></p><p>The Deployment screenshot displays several different IP addresses and interfaces. From left to right:</p><ul><li><strong>Next Hop 10.22.0.1</strong> - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.</li><li><strong>IP/Mask (LAN) 10.22.0.2/24</strong> - This defines the LAN0 interface IP of the EdgeConnect appliance.</li><li><strong>IP/Mask (WAN) 10.32.0.2/24</strong> - This defines the WAN0 interface IP of the EdgeConnect appliance.</li><li><strong>Next Hop 10.32.0.1</strong> - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.</li></ul></div></details><h2 id=1-define-a-common-site-on-the-orchestrator><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#1-define-a-common-site-on-the-orchestrator>&#8203;​</a></span>
<span>1. Define a common site on the Orchestrator</span></h2><p>For all EdgeConnect devices using Cloudflare, modify the devices to put them on the same site. This disables automatic IPSec tunnel creation between the EdgeConnect devices using the same labels for the WAN interfaces in use.</p><p>This step is only required if Cloudflare is used for east-west traffic routing.</p><h2 id=2-configure-overlay-policies><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#2-configure-overlay-policies>&#8203;​</a></span>
<span>2. Configure overlay policies</span></h2><p>We use Aruba Orchestrator’s Business Intent Overlays to create intuitive policies which automatically identify and steer application traffic to Cloudflare. Two Business Intent Overlay (BIO) policies are created in this example.</p><details><summary>GRE tunnel configuration</summary><div class=special-class markdown=1><p>Cloudflare’s <a href=/magic-transit/about/probe-construction/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>tunnel health checks</span></a> are ping reply packets encapsulated in GRE packets. The source IP is the Edgeconnect WAN interface used to establish a tunnel, and the destination IP is Cloudflare servers. These packets need to be sent directly from the WAN interface and not through the established tunnels.</p><p>To create the overlay policy:</p><ol><li>Create a compound application, which is a combination of all <a href=https://www.cloudflare.com/ips/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare public IPs</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> and ICMP packets.</li></ol><p><img src=/magic-wan/static/app-definition.png alt="Application definition screen with IP values"></p><ol start=2><li><p>Create a breakout Business Intent Overlay (BIO) to bypass the GRE tunnel as the first policy and use this newly created application as the match criteria.</p></li><li><p>Define at least one additional overlay policy and the traffic you want to send to Cloudflare over the GRE tunnels.</p></li></ol><p>The service name used to send traffic through the tunnel created in the next step is <strong>Cloudflare_GRE</strong>. The example uses <strong>Match Everything</strong> to send all other traffic through the established tunnel (both private east-west traffic & Internet bound north-south traffic through Cloudflare’s Secure Web Gateway).</p><p><img src=/magic-wan/static/biz-intent-overlay.png alt="Business Intent Overlay screen with breakout and CF overlays"></p></div></details><details><summary>IPsec tunnel configuration</summary><div class=special-class markdown=1><p>Cloudflare’s <a href=/magic-transit/about/probe-construction/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>tunnel health checks</span></a> are ping reply packets encapsulated in IPsec packets. The source IP is the Edgeconnect WAN interface used to establish a tunnel, and the destination IP is Cloudflare servers. These packets need to be sent directly from the WAN interface and not through the established tunnels.</p><p>To create the overlay policy:</p><ol><li>Create a compound application, which is a combination of all <a href=https://www.cloudflare.com/ips/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare public IPs</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> and ICMP packets.</li></ol><p><img src=/magic-wan/static/app-definition.png alt="Application definition screen with IP values"></p><ol start=2><li><p>Create a breakout Business Intent Overlay (BIO) to bypass the IPsec tunnel as the first policy and use this newly created application as the match criteria.</p></li><li><p>Define at least one additional overlay policy and the traffic you want to send to Cloudflare over the IPsec tunnels.</p></li></ol><p>The service name used to send traffic through the tunnel created in the next step is <strong>Cloudflare_IPsec</strong>. The example uses <strong>Match Everything</strong> to send all other traffic through the established tunnel (both private east-west traffic and Internet bound north-south traffic through Cloudflare’s Secure Web Gateway).</p><p><img src=/magic-wan/static/biz-intent-overlay-ipsec.png alt="Business Intent Overlay screen with breakout and CF overlays for IPsec"></p></div></details><h2 id=3-create-tunnels-on-cloudflare-and-edgeconnect><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#3-create-tunnels-on-cloudflare-and-edgeconnect>&#8203;​</a></span>
<span>3. Create tunnels on Cloudflare and EdgeConnect</span></h2><details><summary>GRE tunnel configuration</summary><div class=special-class markdown=1><p><img src=/magic-wan/static/gcp-edgeconnect-diagram.png alt="Diagram of GCP, Aruba Orchestratror, and Cloudflare products"></p><ol><li>Create a tunnel on the EdgeConnect using Cloudflare’s assigned public Anycast IP and the service used in the overlay policy in the <a href=#2-configure-overlay-policies class=DocsMarkdown--link><span class=DocsMarkdown--link-content>previous step</span></a>.</li><li>Create a Virtual Tunnel Interface (VTI) using the private IP pair shared with CF GRE tunnel endpoint and the passthrough tunnel to match the newly created tunnel alias (<strong>CF_GRE_east</strong> in our example).</li></ol><p><img src=/magic-wan/static/modify-passthrough.png alt="Modify Passthrough Tunnel screen"></p><p><img src=/magic-wan/static/edit-vti.png alt="Edit Virtual Tunnel Interface screen"></p><ol start=3><li>Define a GRE tunnel on the Cloudflare dashboard using the EdgeConnect appliance’s public IP and the private IP pair /31 shared with the appliance.</li></ol><p><img src=/magic-wan/static/gre-tunnels-edgeconnect.png alt="GRE tunnels information for each branch"></p></div></details><details><summary>IPsec tunnel configuration</summary><div class=special-class markdown=1><p><img src=/magic-wan/static/gcp-edgeconnect-diagram-ipsec.png alt="Diagram of GCP, Aruba Orchestratror, and Cloudflare products for IPsec tunnels"></p><p>For additional information on creating IPsec tunnels, refer to <a href=https://developers.cloudflare.com/api/operations/magic-i-psec-tunnels-create-i-psec-tunnels class=DocsMarkdown--link><span class=DocsMarkdown--link-content>API documentation for IPsec tunnels</span></a>.</p><ul><li><code>X-Auth-Email</code>: Your Cloudflare email ID</li><li><code>X-Auth-Key</code>: Seen in the URL (dash.cloudflare.com/<x-auth-key>/&mldr;.)</li><li><code>Account key</code>: Global API token in Cloudflare dashboard</li></ul><ol><li>Test new IPsec tunnel creation</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Request
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>curl -X POST <span class=s2>&#34;https://api.cloudflare.com/client/v4/accounts/&lt;account_id&gt;/magic/ipsec_tunnels?validate_only=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Email: user@example.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Key: XXXXXXXXXX&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     --data <span class=s1>&#39;{&#34;ipsec_tunnels&#34;:[{&#34;name&#34;:&#34;EdgeConnect_IPSEC_1&#34;,&#34;customer_endpoint&#34;:&#34;35.188.72.56&#34;,&#34;cloudflare_endpoint&#34;:&#34;172.64.241.205&#34;,&#34;interface_address&#34;:&#34;192.168.10.11/31&#34;,&#34;description&#34;:&#34;Tunnel for EdgeConnect - GCP Central&#34;}]}&#39;</span>
</span></span></code></pre></div><ol start=2><li>Create a new IPsec tunnel</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Request
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>curl -X POST <span class=s2>&#34;https://api.cloudflare.com/client/v4/accounts/&lt;account_id&gt;/magic/ipsec_tunnels&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Email: user@example.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Key: XXXXXXXXXX&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--data <span class=s1>&#39;{&#34;ipsec_tunnels&#34;:[{&#34;name&#34;:&#34;EdgeConnect_IPSEC_1&#34;,&#34;customer_endpoint&#34;:&#34;35.188.72.56&#34;,&#34;cloudflare_endpoint&#34;:&#34;172.64.241.205&#34;,&#34;interface_address&#34;:&#34;192.168.10.11/31&#34;,&#34;description&#34;:&#34;Tunnel for EdgeConnect - GCP Central&#34;}]}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=err>header:</span> <span class=err>Response</span>
</span></span><span class=line><span class=cl><span class=err>---</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ipsec_tunnels&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;tunnel_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;interface_address&#34;</span><span class=p>:</span> <span class=s2>&#34;192.168.10.11/31&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;created_on&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-04-14T19:57:43.938376Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;modified_on&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-04-14T19:57:43.938376Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;EdgeConnect_IPSEC_1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;cloudflare_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;172.64.241.205&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;customer_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;35.188.72.56&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Tunnel for EdgeConnect - GCP Central&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;health_check&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;35.188.72.56&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;reply&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;success&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;errors&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;messages&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol start=3><li>Generate Pre Shared Key (PSK) for tunnel</li></ol><p>Use the tunnel ID from the response in Step 2. Save the pre-shared key generated in this step as you will need it to set up tunnels on the Orchestrator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Request
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>curl -X POST <span class=s2>&#34;https://api.cloudflare.com/client/v4/accounts/&lt;account_id&gt;/magic/ipsec_tunnels/e70536b11daa47e09ff046fbb9800e4f/psk_generate?validate_only=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Email: user@example.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;X-Auth-Key: XXXXXXXXXX&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -H <span class=s2>&#34;Content-Type: application/json&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>header: Response
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;result&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;ipsec_id&#34;</span>: <span class=s2>&#34;&lt;ipsec_id&gt;&#34;</span>,
</span></span><span class=line><span class=cl><span class=s2>&#34;ipsec_tunnel_id&#34;</span>: <span class=s2>&#34;&lt;tunnel_id&gt;&#34;</span>,
</span></span><span class=line><span class=cl><span class=s2>&#34;psk&#34;</span>: <span class=s2>&#34;XXXXXXXXXXXXXXXXX&#34;</span>,
</span></span><span class=line><span class=cl><span class=s2>&#34;psk_metadata&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;last_generated_on&#34;</span>: <span class=s2>&#34;2022-04-14T20:05:29.756514071Z&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>,
</span></span><span class=line><span class=cl><span class=s2>&#34;success&#34;</span>: true,
</span></span><span class=line><span class=cl><span class=s2>&#34;errors&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl><span class=s2>&#34;messages&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><strong>Create an IPSec tunnel on EdgeConnect</strong></p><p>You can create a tunnel after the Business Intent Overlay policies have been defined. Use the correct policy or service created in the <a href=/magic-wan/tutorials/aruba-edgeconnect/#2-configure-overlay-policies-1 class=DocsMarkdown--link><span class=DocsMarkdown--link-content>previous step</span></a>. The local IP is the local WAN interface of the EdgeConnect device, and the remote IP is the Cloudflare public IP assigned as the tunnel endpoint.</p><p><img src=/magic-wan/static/general-modify-passthrough.png alt="Modify Passthrough Tunnel dialog with General values"></p><p><img src=/magic-wan/static/ike-modify-passthrough.png alt="Modify Passthrough Tunnel dialog with IKE values"></p><p><img src=/magic-wan/static/ipsec-modify-passthrough.png alt="Modify Passthrough Tunnel dialog with IPsec values"></p><p><strong>Create a Virtual Tunnel Interface (VTI) on the EdgeConnect appliance</strong></p><p><img src=/magic-wan/static/vti-interface-ipsec.png alt="Values for Edit VTI Interface"></p></div></details><h2 id=4-create-static-routes-on-cloudflare-and-edgeconnect><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#4-create-static-routes-on-cloudflare-and-edgeconnect>&#8203;​</a></span>
<span>4. Create static routes on Cloudflare and EdgeConnect</span></h2><details><summary>GRE tunnel configuration</summary><div class=special-class markdown=1><ol><li><p>Define static routes on the Cloudflare dashboard for the LAN subnet(s) attached to the EdgeConnect appliance. Use the private IP pair for the EdgeConnect tunnel endpoint.</p><p>In the example below, the traffic to subnet 10.3.0.0/16 attached to the <strong>east_branch</strong> EdgeConnect appliance has a next hop of 10.40.8.10.</p></li></ol><p><img src=/magic-wan/static/static-routes-cf.png alt="Static route information for each branch"></p><ol start=2><li><p>Define static routes on the Orchestrator so Cloudflare can route traffic between sites.</p><p>In the example below, we create a route for the subnet 10.30.0.0/24 on the <strong>west_branch</strong> to be routed via the established GRE tunnel between the EdgeConnect appliance and Cloudflare.</p></li></ol><p><img src=/magic-wan/static/static-routes-edgeconnect.png alt="Static route information for each branch"></p></div></details><details><summary>IPsec tunnel configuration</summary><div class=special-class markdown=1><p><img src=/magic-wan/static/static-routes-ipsec.png alt="Static route values from Cloudflare dashboard"></p><p><strong>Static routes for central branch on EdgeConnect</strong></p><p><img src=/magic-wan/static/static-routes-central-ipsec.png alt="Static route values from EdgeConnect for central branch"></p><p><strong>Static routes for west branch on EdgeConnect</strong></p><p><img src=/magic-wan/static/static-routes-west-ipsec.png alt="Static route values from EdgeConnect for west branch"></p></div></details><h2 id=5-validate-traffic-flow><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#5-validate-traffic-flow>&#8203;​</a></span>
<span>5. Validate traffic flow</span></h2><details><summary>GRE tunnel configuration</summary><div class=special-class markdown=1><p><strong>Validate Secure Web Gateway</strong></p><p>To validate traffic flow from the local subnet through Cloudflare’s Secure Web Gateway, perform a curl as show in the example below.</p><p><img src=/magic-wan/static/validate-swg-curl.png alt="Curl example for validating Secure Web Gateway"></p><p>You can validate the request went through Gateway with the presence of the <code>Cf-Team</code> response header, or by looking at the logs in the dashboard under <strong>Logs</strong> > <strong>Gateway</strong> > <strong>HTTP</strong>.</p><p><img src=/magic-wan/static/dash-validate-swg.png alt="Dashboard example for validating Secure Web Gateway"></p><p><strong>Validate east-west traffic</strong></p><p>To validate east-west traffic flow, perform a traceroute as shown in the example.</p><p><img src=/magic-wan/static/validate-traceroute.png alt="Traceroute example for verifying east-west traffic"></p><p>The example shows a client in GCP East (10.3.0.3), which can ping the private IP of a client in GCP West (10.30.0.4).</p><p>The traceroute shows the path going from the client (10.3.0.3)<br>→ to the GCP East lan0 IP on the EdgeConnect (10.3.0.2)<br>→ to the Cloudflare private GRE endpoint IP (10.4.8.11)<br>→ to the GCP West lan0 IP on the West EdgeConnect (10.30.0.3)<br>→ to the GCP West client (10.30.0.4).</p><p>This validates the east-west traffic flow through Cloudflare Magic WAN.</p></div></details><details><summary>IPsec tunnel configuration</summary><div class=special-class markdown=1><p><strong>Validate Secure Web Gateway</strong></p><p>To validate traffic flow from the local subnet through Cloudflare’s Secure Web Gateway, perform a cURL as shown in the example below.</p><p><img src=/magic-wan/static/static-routes-west-ipsec.png alt="cURL example for validating traffic"></p><p>You can validate the request was sent through Secure Web Gateway with the presence of the <code>Cf-Team</code> response header or by looking at the logs in the dashboard under <strong>Logs</strong> > <strong>Gateway</strong> > <strong>HTTP</strong>.</p><p><img src=/magic-wan/static/dash-validation-ipsec.png alt="Dashboard example for validating Secure Web Gateway"></p><p><strong>Validate east-west traffic</strong></p><p>To validate east-west traffic flow, perform a traceroute as shown in the example.</p><p><img src=/magic-wan/static/traceroute-ipsec.png alt="Traceroute example for IPsec validation"></p><p>The example shows a client in GCP Central (10.22.0.9), which can ping the private IP of a client in GCP West (10.77.0.10).</p><p>The traceroute shows the path going from the client (10.22.0.9)<br>→ to the GCP Central lan0 IP on the EdgeConnect (10.22.0.2)<br>→ to the Cloudflare private IPSec endpoint IP (192.168.10.11)<br>→ to the GCP West EdgeConnect private IPSec endpoint IP (192.168.15.10)<br>→ to the GCP West client (10.77.0.10).</p><p>This validates the east-west traffic flow through Cloudflare Magic WAN.</p></div></details><h2 id=6-cloudflare-policies><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#6-cloudflare-policies>&#8203;​</a></span>
<span>6. Cloudflare policies</span></h2><p>At this point, the GRE or IPsec tunnels should be connected from the EdgeConnect appliances to Cloudflare&rsquo;s edge, and traffic is scoped to route over the tunnels using the EdgeConnect Business Intent Overlays.</p><p>To begin filtering traffic and gathering analytics, refer to the <a href=/magic-firewall/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Magic Firewall documentation</span></a> to learn how to create filters for east-west inter-branch traffic and the <a href=/cloudflare-one/policies/filtering/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Secure Web Gateway documentation</span></a> to learn how to configure Gateway policies if you decide to send traffic from your local private subnets to the Internet through Cloudflare Gateway.</p></article></div></main><footer class=DocsFooter><div class=DocsFooter--content><div class=DocsFooterResources><span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/magic-wan" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare Dashboard</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://community.cloudflare.com class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Community</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://www.cloudflare.com/learning/network-layer/what-is-the-network-layer/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Learning Center</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/support" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Support Portal</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span></div><div><span class=DocsFooter--edit-on-gh-link-wrapper><a href=https://github.com/panthere2k/panthere2k.github.io/blob/content/content/magic-wan/tutorials/aruba-edgeconnect.md class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Edit on GitHub</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; · &nbsp;</span>
<span class=DocsFooter--content-time>Updated <time class=relative datetime=2023-01-02T09:58:19+09:00 title=2023-01-02>January 2, 2023</time></span></div></div></footer></div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PKQFGQB")</script><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style></noscript><script defer src=https://unpkg.com/littlefoot/dist/littlefoot.js type=application/javascript></script>
<script type=application/javascript>document.addEventListener("DOMContentLoaded",()=>littlefoot.default())</script></body></html>